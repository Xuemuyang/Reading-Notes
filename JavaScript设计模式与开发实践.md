# JavaScriptè®¾è®¡æ¨¡å¼ä¸Žå¼€å‘å®žè·µ

## å‰è¨€

"æ¨¡å¼"æœ€æ—©è¯žç”ŸäºŽå»ºç­‘å­¦ã€‚å“ˆä½›å¤§å­¦å»ºç­‘å­¦åšå£«Christopher Alexanderå’Œä»–çš„ç ”ç©¶å›¢é˜ŸèŠ±äº†çº¦20å¹´çš„æ—¶é—´ï¼Œç ”ç©¶äº†ä¸ºè§£å†³åŒä¸€ä¸ªé—®é¢˜è€Œè®¾è®¡å‡ºçš„ä¸åŒå»ºç­‘ç»“æž„ï¼Œä»Žä¸­å‘çŽ°äº†é‚£äº›é«˜è´¨é‡è®¾è®¡ä¸­çš„ç›¸ä¼¼æ€§ï¼Œå¹¶ä¸”ç”¨"æ¨¡å¼"æ¥æŒ‡ä»£è¿™ç§ç›¸ä¼¼æ€§ã€‚

é€šä¿—ä¸€ç‚¹æ¥è¯´ï¼Œè®¾è®¡æ¨¡å¼æ˜¯åœ¨æŸç§åœºåˆä¸‹å¯¹æŸä¸ªé—®é¢˜çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚

"å¥½çš„è®¾è®¡"å¹¶ä¸æ˜¯æŸäººå‘æ˜Žçš„ï¼Œè€Œæ˜¯ä¸€ç›´å­˜åœ¨çš„ï¼Œå¤§å®¶ä¼šå‡­ç»éªŒä¸€ç›´ä½¿ç”¨ï¼Œ"æ¨¡å¼"ä¸è¿‡æ˜¯ç»™"å¥½çš„è®¾è®¡"èµ·ä¸ªåå­—ã€‚

è®¾è®¡æ¨¡å¼çš„ä½œç”¨æ˜¯è®©äººä»¬å†™å‡ºå¯å¤ç”¨å’Œå¯ç»´æŠ¤æ€§é«˜çš„ç¨‹åºã€‚

æ‰€æœ‰è®¾è®¡æ¨¡å¼çš„å®žçŽ°éƒ½éµå¾ª"æ‰¾å‡ºç¨‹åºä¸­å˜åŒ–çš„åœ°æ–¹ï¼Œå°†å…¶å°è£…èµ·æ¥"ã€‚

## ç¬¬ä¸€éƒ¨åˆ† åŸºç¡€çŸ¥è¯†

### ç¬¬1ç«  é¢å‘å¯¹è±¡çš„JavaScript

#### åŠ¨æ€ç±»åž‹è¯­è¨€å’Œé¸­å­ç±»åž‹

ç¼–ç¨‹è¯­è¨€æŒ‰ç…§æ•°æ®ç±»åž‹å¤§ä½“å¯ä»¥åˆ†ä¸ºä¸¤ç±»

+ é™æ€ç±»åž‹è¯­è¨€(ç¼–è¯‘æ—¶ç¡®å®šç±»åž‹)
+ åŠ¨æ€ç±»åž‹è¯­è¨€(è¿è¡Œæ—¶ç¡®å®šç±»åž‹)

> é¸­å­ç±»åž‹(duck typing)ï¼Œå¦‚æžœå®ƒèµ°èµ·è·¯æ¥åƒé¸­å­ï¼Œå«èµ·æ¥ä¹Ÿæ˜¯é¸­å­ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯é¸­å­ã€‚

åœ¨åŠ¨æ€ç±»åž‹è¯­è¨€çš„é¢ç›¸å¯¹è±¡è®¾è®¡ä¸­ï¼Œé¸­å­ç±»åž‹çš„æ¦‚å¿µè‡³å…³é‡è¦ã€‚æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å®žçŽ°"é¢ç›¸æŽ¥å£ç¼–ç¨‹"ã€‚ä¾‹å¦‚ä¸€ä¸ªå¯¹è±¡è‹¥æœ‰`push`å’Œ`pop`æ–¹æ³•ï¼Œå®ƒå°±å¯ä»¥è¢«å½“åšæ ˆæ¥ä½¿ç”¨ã€‚

#### å¤šæ€

JavaScriptå¯¹è±¡çš„å¤šæ€æ€§æ˜¯ä¸Žç”Ÿä¿±æ¥çš„ï¼ŒæŸä¸€ç§åŠ¨ç‰©èƒ½å¦å‘å‡ºå«å£°ï¼Œåªå–å†³äºŽå®ƒæœ‰æ²¡æœ‰`makeSound`æ–¹æ³•ï¼Œè€Œä¸å–å†³äºŽå®ƒæ˜¯å¦æ˜¯æŸç§ç±»åž‹çš„å¯¹è±¡ã€‚

> å¤šæ€æœ€æ ¹æœ¬çš„ä½œç”¨å°±æ˜¯é€šè¿‡å§è¿‡ç¨‹åŒ–çš„æ¡ä»¶åˆ†æ”¯è¯­å¥è½¬åŒ–ä¸ºå¯¹è±¡çš„å¤šæ€æ€§ï¼Œä»Žè€Œæ¶ˆé™¤è¿™äº›æ¡ä»¶åˆ†æ”¯è¯­å¥ã€‚

ä¸€ä¸ªä¾‹å­å¾ˆå¥½çš„è¯ é‡Š

ç”µå½±æ‹æ‘„çŽ°åœºï¼Œå¯¼æ¼”å–Šå‡º"action"ï¼Œä¸»è§’å¼€å§‹èƒŒå°è¯ï¼Œç¯å…‰å¸ˆå‚…æ‰“ç¯ï¼Œç¾¤ä¼—æ¼”å‘˜å€’åœ°ã€‚å¾—åˆ°åŒä¸€ä¸ªæ¶ˆæ¯æ—¶ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½çŸ¥é“è‡ªå·±åº”è¯¥åšä»€ä¹ˆã€‚

æ¯ä¸ªå¯¹è±¡è¯¥åšä»€ä¹ˆï¼Œäº‹å…ˆå·²ç»æ˜¯è¯¥å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ï¼Œè¢«å®‰è£…åœ¨å¯¹è±¡çš„å†…éƒ¨ã€‚

ç”¨ä»£ç ä¸¾ä¸ªðŸŒ°

ä¸€ä¸ªåœ°å›¾åº”ç”¨ï¼Œæˆ‘ä»¬é€‰æ‹©googleçš„API

```js
const googleMap = {
  show() {
    console.log('å¼€å§‹æ¸²æŸ“è°·æ­Œåœ°å›¾')
  }
}

const renderMap = () => {
  googleMap.show()
}

renderMap()
```

åŽæ¥ç”±äºŽæŸäº›åŽŸå› ï¼Œæˆ‘ä»¬éœ€è¦æŠŠgoogleæ¢æˆç™¾åº¦ï¼ŒäºŽæ˜¯ä»£ç å˜æˆäº†è¿™æ ·:

```js
const googleMap = {
  show() {
    console.log('å¼€å§‹æ¸²æŸ“è°·æ­Œåœ°å›¾')
  }
}

const baiduMap = {
  show() {
    console.log('å¼€å§‹æ¸²æŸ“ç™¾åº¦åœ°å›¾')
  }
}

const renderMap = type => {
  if (type === 'google') {
    googleMap.show()
  } else if (type === 'baidu') {
    baiduMap.show()
  }
}

renderMap('google')
renderMap('baidu')
```

ä¸€æ—¦éœ€è¦å°†å…¶æ¢æˆé«˜å¾·åœ°å›¾ï¼Œå¿…é¡»è¦æ”¹åŠ¨renderMapå‡½æ•°ï¼Œç»§ç»­å †ç Œæ¡ä»¶åˆ†æ”¯è¯­å¥ã€‚

å°†ç¨‹åºä¸­ç›¸åŒçš„éƒ¨åˆ†æŠ½è±¡å‡ºæ¥:

```js
const renderMap = map => {
  if (map.show instanceof Function) {
    map.show()
  }
}

renderMap(googleMap)
renderMap(baiduMap)
```

#### å°è£…

#### åŽŸåž‹æ¨¡å¼å’ŒåŸºäºŽåŽŸåž‹ç»§æ‰¿çš„JavaScriptå¯¹è±¡ç³»ç»Ÿ

åŽŸåž‹æ¨¡å¼çš„å®žçŽ°å…³é”®ï¼Œæ˜¯è¯­è¨€æœ¬èº«æ˜¯å¦æä¾›äº†`clone`çš„æ–¹æ³•ã€‚

```js
Object.create = Object.create || function( obj ){
  const F = function(){}
  F.prototype = obj
  return new F()
}
```

åŸºäºŽåŽŸåž‹é“¾çš„å§”æ‰˜æœºåˆ¶å°±æ˜¯åŽŸåž‹ç»§æ‰¿çš„æœ¬è´¨ã€‚

åŽŸåž‹ç¼–ç¨‹èŒƒåž‹è‡³å°‘åŒ…æ‹¬ä»¥ä¸‹åŸºæœ¬è§„åˆ™:

+ æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯å¯¹è±¡
+ è¦å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œä¸æ˜¯é€šè¿‡å®žä¾‹åŒ–ç±»ï¼Œè€Œæ˜¯æ‰¾åˆ°ä¸€ä¸ªå¯¹è±¡ä½œä¸ºåŽŸåž‹å¹¶å…‹éš†å®ƒ
+ å¯¹è±¡ä¼šè®°ä½å®ƒçš„åŽŸåž‹
+ å¦‚æžœå¯¹è±¡æ— æ³•å“åº”æŸä¸ªè¯·æ±‚ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™å®ƒè‡ªå·±çš„åŽŸåž‹

##### JavaScriptä¸­çš„åŽŸåž‹ç»§æ‰¿

è¦å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œä¸æ˜¯é€šè¿‡å®žä¾‹åŒ–ç±»ï¼Œè€Œæ˜¯æ‰¾åˆ°ä¸€ä¸ªå¯¹è±¡ä½œä¸ºåŽŸåž‹å¹¶å…‹éš†å®ƒã€‚

JavaScriptä¸ªå¯¹è±¡æä¾›äº†ä¸€ä¸ªåä¸º`__proto__`çš„éšè—å±žæ€§ï¼ŒæŸä¸ªå¯¹è±¡çš„`__proto__`å±žæ€§é»˜è®¤ä¼šæŒ‡å‘å®ƒçš„æž„é€ å™¨çš„åŽŸåž‹å¯¹è±¡ï¼Œå³{Construcrot}.prototypeã€‚åœ¨ä¸€äº›æµè§ˆå™¨ä¸Š`__proto__`å±žæ€§è¢«å…¬å¼€å‡ºæ¥ã€‚

```js
const a = new Object()
console.log(a.__proto__ === Object.prototype)
```

### ç¬¬2ç«  thisã€callå’Œapply

#### this

`this`çš„æŒ‡å‘å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å››ç§:

+ ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨
+ ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨
+ æž„é€ å™¨è°ƒç”¨
+ Function.prototype.callæˆ–Function.prototype.applyè°ƒç”¨

å½“å‡½æ•°ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œ`this`æŒ‡å‘è¯¥å¯¹è±¡

å‡½æ•°ä¸ä½œä¸ºå¯¹è±¡çš„å±žæ€§è¢«è°ƒç”¨æ—¶ï¼Œ`this`æ€»æ˜¯æŒ‡å‘å…¨å±€å¯¹è±¡

å½“ç”¨`new`è¿ç®—ç¬¦è°ƒç”¨å‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°æ€»ä¼šè¿”å›žä¸€ä¸ªå¯¹è±¡ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæž„é€ å™¨é‡Œçš„`this`å°±æŒ‡å‘è¿”å›žçš„è¿™ä¸ªå¯¹è±¡:

```js
let MyClass = function() {
  this.name = 'hehe'
}

let obj = new MyClass()
alert(obj.name) // output: hehe
```

å¦‚æžœæž„é€ å™¨æ˜¾å¼è¿”å›žäº†ä¸€ä¸ªobjectç±»åž‹çš„å¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤æ¬¡è¿ç®—ç»“æžœæœ€ç»ˆä¼šè¿”å›žè¿™ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¹‹å‰æœŸå¾…çš„`this`ã€‚

```js
let MyClass = function() {
  this.name = 'hehe'
  return {
    name: 'haha'
  }
}
var obj = new MyClass()
alert ( obj.name ) // è¾“å‡º:haha
```

#### callå’Œapply

èƒ½å¤Ÿç†Ÿç»ƒä½¿ç”¨`call`å’Œ`apply`æ˜¯çœŸæ­£æˆä¸ºJavaScriptç¨‹åºå‘˜çš„é‡è¦ä¸€æ­¥ã€‚

##### callå’Œapplyçš„ç”¨é€”

1.æ”¹å˜`this`æŒ‡å‘

```js
document.getElementById = (function(func){
  return function() {
    return func.apply(document, arguments)
  }
})(document.getElementById)
var getId = document.getElementById
var div = getId('div')
alert(div.id)
```

2.Function.prototype.bind
3.å€Ÿç”¨å…¶ä»–å¯¹è±¡çš„æ–¹æ³•

### ç¬¬3ç«  é—­åŒ…å’Œé«˜é˜¶å‡½æ•°

#### é—­åŒ…

ä¸€ä¸ªðŸŒ°

```js
const Type = {};

for (let i = 0, type; type = ['String', 'Array', 'Number'][i++];) {
  Type['is' + type] = obj => {
    return Object.prototype.toString.call(obj) === `[object ${type}]`
  }
};

Type.isArray([])
Type.isString('str')
```

##### å°è£…å˜é‡

é—­åŒ…å¯ä»¥å°†ä¸€äº›ä¸éœ€è¦æš´éœ²åœ¨å…¨å±€çš„å˜é‡å°è£…æˆ"ç§æœ‰å˜é‡"ã€‚

```js
const mult = (...args) => {
  let val  = 1
  for (let i = 0; i < args.length; i++) {
    val *= args[i]
  }
  return val
}
```

åŠ å…¥ç¼“å­˜æ¥æé«˜è¿™ä¸ªå‡½æ•°çš„æ€§èƒ½

```js
const cache = {}

const mult = (...args) => {
  let key = args.join(',')
  if (cache[key]) {
    return cache[key]
  }
  let val = 1
  for (let i = 0; i < args.length; i++) {
    val *= args[i]
  }
  return cache[key] = val
}
```

`cache`è¿™ä¸ªå˜é‡ä»…ä»…åœ¨`mult`å‡½æ•°ä¸­è¢«ä½¿ç”¨ï¼Œå°†å…¶å°é—­åœ¨`mult`å‡½æ•°å†…éƒ¨ã€‚

```js
const mult = () => {
  const cache = {}
  return function (...args) {
    let key = args.join(',')
    if (key in cache) {
      return cache[key]
    }
    let val = 1
    for (let i = 0; i < args.length; i++) {
      val *= args[i]
    }
    return cache[key] = val
  }
}
```

æç‚¼å‡½æ•°æ˜¯ä»£ç é‡æž„ä¸­çš„å¸¸è§æŠ€å·§ï¼Œå¦‚æžœåœ¨ä¸€ä¸ªå¤§å‡½æ•°ä¸­æœ‰ä¸€äº›ä»£ç å—èƒ½å¤Ÿç‹¬ç«‹å‡ºæ¥ï¼Œå¸¸å¸¸æŠŠè¿™äº›ä»£ç å—å°è£…åœ¨ç‹¬ç«‹çš„å°å‡½æ•°é‡Œé¢ã€‚ç‹¬ç«‹å‡ºæ¥çš„å°å‡½æ•°æœ‰åŠ©äºŽä»£ç å¤ç”¨ï¼Œå¦‚æžœè¿™äº›å°å‡½æ•°æœ‰ä¸€ä¸ªè‰¯å¥½çš„å‘½åï¼Œå®ƒä»¬æœ¬èº«ä¹Ÿèµ·åˆ°äº†æ³¨é‡Šçš„ä½œç”¨ã€‚

```js
const mult = () => {
  const cache = {}
  const calculate = (...args) => {
    let val = 1
    for (let i = 0; i < args.length; i++) {
      val *= args[i]
    }
    return val
  }
  return function (...args) {
    let key = args.join(',')
    if (key in cache) {
      return cache[key]
    }
    return cache[key] = calculate.apply(null, args)
  }
}
```

#### é«˜é˜¶å‡½æ•°