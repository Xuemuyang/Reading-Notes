# JavaScriptè®¾è®¡æ¨¡å¼ä¸å¼€å‘å®è·µ

## å‰è¨€

"æ¨¡å¼"æœ€æ—©è¯ç”Ÿäºå»ºç­‘å­¦ã€‚å“ˆä½›å¤§å­¦å»ºç­‘å­¦åšå£«Christopher Alexanderå’Œä»–çš„ç ”ç©¶å›¢é˜ŸèŠ±äº†çº¦20å¹´çš„æ—¶é—´ï¼Œç ”ç©¶äº†ä¸ºè§£å†³åŒä¸€ä¸ªé—®é¢˜è€Œè®¾è®¡å‡ºçš„ä¸åŒå»ºç­‘ç»“æ„ï¼Œä»ä¸­å‘ç°äº†é‚£äº›é«˜è´¨é‡è®¾è®¡ä¸­çš„ç›¸ä¼¼æ€§ï¼Œå¹¶ä¸”ç”¨"æ¨¡å¼"æ¥æŒ‡ä»£è¿™ç§ç›¸ä¼¼æ€§ã€‚

é€šä¿—ä¸€ç‚¹æ¥è¯´ï¼Œè®¾è®¡æ¨¡å¼æ˜¯åœ¨æŸç§åœºåˆä¸‹å¯¹æŸä¸ªé—®é¢˜çš„ä¸€ç§è§£å†³æ–¹æ¡ˆã€‚

"å¥½çš„è®¾è®¡"å¹¶ä¸æ˜¯æŸäººå‘æ˜çš„ï¼Œè€Œæ˜¯ä¸€ç›´å­˜åœ¨çš„ï¼Œå¤§å®¶ä¼šå‡­ç»éªŒä¸€ç›´ä½¿ç”¨ï¼Œ"æ¨¡å¼"ä¸è¿‡æ˜¯ç»™"å¥½çš„è®¾è®¡"èµ·ä¸ªåå­—ã€‚

è®¾è®¡æ¨¡å¼çš„ä½œç”¨æ˜¯è®©äººä»¬å†™å‡ºå¯å¤ç”¨å’Œå¯ç»´æŠ¤æ€§é«˜çš„ç¨‹åºã€‚

æ‰€æœ‰è®¾è®¡æ¨¡å¼çš„å®ç°éƒ½éµå¾ª"æ‰¾å‡ºç¨‹åºä¸­å˜åŒ–çš„åœ°æ–¹ï¼Œå°†å…¶å°è£…èµ·æ¥"ã€‚

â€œé«˜å†…èšï¼Œä½è€¦åˆâ€

å†…èšæŒ‡çš„æ˜¯æ¨¡å—å†…éƒ¨ä»£ç çš„å…³è”ç¨‹åº¦ï¼Œè€¦åˆåˆ™æ˜¯æ¨¡å—é—´çš„å…³è”ç¨‹åº¦ã€‚

## ç¬¬ä¸€éƒ¨åˆ† åŸºç¡€çŸ¥è¯†

### ç¬¬1ç«  é¢å‘å¯¹è±¡çš„JavaScript

#### åŠ¨æ€ç±»å‹è¯­è¨€å’Œé¸­å­ç±»å‹

ç¼–ç¨‹è¯­è¨€æŒ‰ç…§æ•°æ®ç±»å‹å¤§ä½“å¯ä»¥åˆ†ä¸ºä¸¤ç±»

+ é™æ€ç±»å‹è¯­è¨€(ç¼–è¯‘æ—¶ç¡®å®šç±»å‹)
+ åŠ¨æ€ç±»å‹è¯­è¨€(è¿è¡Œæ—¶ç¡®å®šç±»å‹)

> é¸­å­ç±»å‹(duck typing)ï¼Œå¦‚æœå®ƒèµ°èµ·è·¯æ¥åƒé¸­å­ï¼Œå«èµ·æ¥ä¹Ÿæ˜¯é¸­å­ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯é¸­å­ã€‚

åœ¨åŠ¨æ€ç±»å‹è¯­è¨€çš„é¢ç›¸å¯¹è±¡è®¾è®¡ä¸­ï¼Œé¸­å­ç±»å‹çš„æ¦‚å¿µè‡³å…³é‡è¦ã€‚æˆ‘ä»¬å¯ä»¥è½»æ¾åœ°å®ç°"é¢ç›¸æ¥å£ç¼–ç¨‹"ã€‚ä¾‹å¦‚ä¸€ä¸ªå¯¹è±¡è‹¥æœ‰`push`å’Œ`pop`æ–¹æ³•ï¼Œå®ƒå°±å¯ä»¥è¢«å½“åšæ ˆæ¥ä½¿ç”¨ã€‚

#### å¤šæ€

JavaScriptå¯¹è±¡çš„å¤šæ€æ€§æ˜¯ä¸ç”Ÿä¿±æ¥çš„ï¼ŒæŸä¸€ç§åŠ¨ç‰©èƒ½å¦å‘å‡ºå«å£°ï¼Œåªå–å†³äºå®ƒæœ‰æ²¡æœ‰`makeSound`æ–¹æ³•ï¼Œè€Œä¸å–å†³äºå®ƒæ˜¯å¦æ˜¯æŸç§ç±»å‹çš„å¯¹è±¡ã€‚

> å¤šæ€æœ€æ ¹æœ¬çš„ä½œç”¨å°±æ˜¯é€šè¿‡æŠŠè¿‡ç¨‹åŒ–çš„æ¡ä»¶åˆ†æ”¯è¯­å¥è½¬åŒ–ä¸ºå¯¹è±¡çš„å¤šæ€æ€§ï¼Œä»è€Œæ¶ˆé™¤è¿™äº›æ¡ä»¶åˆ†æ”¯è¯­å¥ã€‚

ä¸€ä¸ªä¾‹å­å¾ˆå¥½çš„è¯ é‡Š

ç”µå½±æ‹æ‘„ç°åœºï¼Œå¯¼æ¼”å–Šå‡º"action"ï¼Œä¸»è§’å¼€å§‹èƒŒå°è¯ï¼Œç¯å…‰å¸ˆå‚…æ‰“ç¯ï¼Œç¾¤ä¼—æ¼”å‘˜å€’åœ°ã€‚å¾—åˆ°åŒä¸€ä¸ªæ¶ˆæ¯æ—¶ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½çŸ¥é“è‡ªå·±åº”è¯¥åšä»€ä¹ˆã€‚

æ¯ä¸ªå¯¹è±¡è¯¥åšä»€ä¹ˆï¼Œäº‹å…ˆå·²ç»æ˜¯è¯¥å¯¹è±¡çš„ä¸€ä¸ªæ–¹æ³•ï¼Œè¢«å®‰è£…åœ¨å¯¹è±¡çš„å†…éƒ¨ã€‚

ç”¨ä»£ç ä¸¾ä¸ªğŸŒ°

ä¸€ä¸ªåœ°å›¾åº”ç”¨ï¼Œæˆ‘ä»¬é€‰æ‹©googleçš„API

```js
const googleMap = {
  show() {
    console.log('å¼€å§‹æ¸²æŸ“è°·æ­Œåœ°å›¾')
  }
}

const renderMap = () => {
  googleMap.show()
}

renderMap()
```

åæ¥ç”±äºæŸäº›åŸå› ï¼Œæˆ‘ä»¬éœ€è¦æŠŠgoogleæ¢æˆç™¾åº¦ï¼Œäºæ˜¯ä»£ç å˜æˆäº†è¿™æ ·:

```js
const googleMap = {
  show() {
    console.log('å¼€å§‹æ¸²æŸ“è°·æ­Œåœ°å›¾')
  }
}

const baiduMap = {
  show() {
    console.log('å¼€å§‹æ¸²æŸ“ç™¾åº¦åœ°å›¾')
  }
}

const renderMap = type => {
  if (type === 'google') {
    googleMap.show()
  } else if (type === 'baidu') {
    baiduMap.show()
  }
}

renderMap('google')
renderMap('baidu')
```

ä¸€æ—¦éœ€è¦å°†å…¶æ¢æˆé«˜å¾·åœ°å›¾ï¼Œå¿…é¡»è¦æ”¹åŠ¨renderMapå‡½æ•°ï¼Œç»§ç»­å †ç Œæ¡ä»¶åˆ†æ”¯è¯­å¥ã€‚

å°†ç¨‹åºä¸­ç›¸åŒçš„éƒ¨åˆ†æŠ½è±¡å‡ºæ¥:

```js
const renderMap = map => {
  if (map.show instanceof Function) {
    map.show()
  }
}

renderMap(googleMap)
renderMap(baiduMap)
```

#### å°è£…

#### åŸå‹æ¨¡å¼å’ŒåŸºäºåŸå‹ç»§æ‰¿çš„JavaScriptå¯¹è±¡ç³»ç»Ÿ

åŸå‹æ¨¡å¼çš„å®ç°å…³é”®ï¼Œæ˜¯è¯­è¨€æœ¬èº«æ˜¯å¦æä¾›äº†`clone`çš„æ–¹æ³•ã€‚

```js
Object.create = Object.create || function( obj ){
  const F = function(){}
  F.prototype = obj
  return new F()
}
```

åŸºäºåŸå‹é“¾çš„å§”æ‰˜æœºåˆ¶å°±æ˜¯åŸå‹ç»§æ‰¿çš„æœ¬è´¨ã€‚

åŸå‹ç¼–ç¨‹èŒƒå‹è‡³å°‘åŒ…æ‹¬ä»¥ä¸‹åŸºæœ¬è§„åˆ™:

+ æ‰€æœ‰çš„æ•°æ®éƒ½æ˜¯å¯¹è±¡
+ è¦å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œä¸æ˜¯é€šè¿‡å®ä¾‹åŒ–ç±»ï¼Œè€Œæ˜¯æ‰¾åˆ°ä¸€ä¸ªå¯¹è±¡ä½œä¸ºåŸå‹å¹¶å…‹éš†å®ƒ
+ å¯¹è±¡ä¼šè®°ä½å®ƒçš„åŸå‹
+ å¦‚æœå¯¹è±¡æ— æ³•å“åº”æŸä¸ªè¯·æ±‚ï¼Œå®ƒä¼šæŠŠè¿™ä¸ªè¯·æ±‚å§”æ‰˜ç»™å®ƒè‡ªå·±çš„åŸå‹

##### JavaScriptä¸­çš„åŸå‹ç»§æ‰¿

è¦å¾—åˆ°ä¸€ä¸ªå¯¹è±¡ï¼Œä¸æ˜¯é€šè¿‡å®ä¾‹åŒ–ç±»ï¼Œè€Œæ˜¯æ‰¾åˆ°ä¸€ä¸ªå¯¹è±¡ä½œä¸ºåŸå‹å¹¶å…‹éš†å®ƒã€‚

JavaScriptä¸ªå¯¹è±¡æä¾›äº†ä¸€ä¸ªåä¸º`__proto__`çš„éšè—å±æ€§ï¼ŒæŸä¸ªå¯¹è±¡çš„`__proto__`å±æ€§é»˜è®¤ä¼šæŒ‡å‘å®ƒçš„æ„é€ å™¨çš„åŸå‹å¯¹è±¡ï¼Œå³{Construcrot}.prototypeã€‚åœ¨ä¸€äº›æµè§ˆå™¨ä¸Š`__proto__`å±æ€§è¢«å…¬å¼€å‡ºæ¥ã€‚

```js
const a = new Object()
console.log(a.__proto__ === Object.prototype)
```

### ç¬¬2ç«  thisã€callå’Œapply

#### this

`this`çš„æŒ‡å‘å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å››ç§:

+ ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è°ƒç”¨
+ ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨
+ æ„é€ å™¨è°ƒç”¨
+ Function.prototype.callæˆ–Function.prototype.applyè°ƒç”¨

å½“å‡½æ•°ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶ï¼Œ`this`æŒ‡å‘è¯¥å¯¹è±¡

å‡½æ•°ä¸ä½œä¸ºå¯¹è±¡çš„å±æ€§è¢«è°ƒç”¨æ—¶ï¼Œ`this`æ€»æ˜¯æŒ‡å‘å…¨å±€å¯¹è±¡

å½“ç”¨`new`è¿ç®—ç¬¦è°ƒç”¨å‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°æ€»ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæ„é€ å™¨é‡Œçš„`this`å°±æŒ‡å‘è¿”å›çš„è¿™ä¸ªå¯¹è±¡:

```js
let MyClass = function() {
  this.name = 'hehe'
}

let obj = new MyClass()
alert(obj.name) // output: hehe
```

å¦‚æœæ„é€ å™¨æ˜¾å¼è¿”å›äº†ä¸€ä¸ªobjectç±»å‹çš„å¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤æ¬¡è¿ç®—ç»“æœæœ€ç»ˆä¼šè¿”å›è¿™ä¸ªå¯¹è±¡ï¼Œè€Œä¸æ˜¯ä¹‹å‰æœŸå¾…çš„`this`ã€‚

```js
let MyClass = function() {
  this.name = 'hehe'
  return {
    name: 'haha'
  }
}
var obj = new MyClass()
alert ( obj.name ) // è¾“å‡º:haha
```

#### callå’Œapply

èƒ½å¤Ÿç†Ÿç»ƒä½¿ç”¨`call`å’Œ`apply`æ˜¯çœŸæ­£æˆä¸ºJavaScriptç¨‹åºå‘˜çš„é‡è¦ä¸€æ­¥ã€‚

##### callå’Œapplyçš„ç”¨é€”

1.æ”¹å˜`this`æŒ‡å‘

```js
document.getElementById = (function(func){
  return function() {
    return func.apply(document, arguments)
  }
})(document.getElementById)
var getId = document.getElementById
var div = getId('div')
alert(div.id)
```

2.Function.prototype.bind
3.å€Ÿç”¨å…¶ä»–å¯¹è±¡çš„æ–¹æ³•

### ç¬¬3ç«  é—­åŒ…å’Œé«˜é˜¶å‡½æ•°

#### é—­åŒ…

ä¸€ä¸ªğŸŒ°

```js
const Type = {};

for (let i = 0, type; type = ['String', 'Array', 'Number'][i++];) {
  Type['is' + type] = obj => {
    return Object.prototype.toString.call(obj) === `[object ${type}]`
  }
};

Type.isArray([])
Type.isString('str')
```

##### å°è£…å˜é‡

é—­åŒ…å¯ä»¥å°†ä¸€äº›ä¸éœ€è¦æš´éœ²åœ¨å…¨å±€çš„å˜é‡å°è£…æˆ"ç§æœ‰å˜é‡"ã€‚

```js
const mult = (...args) => {
  let val  = 1
  for (let i = 0; i < args.length; i++) {
    val *= args[i]
  }
  return val
}
```

åŠ å…¥ç¼“å­˜æ¥æé«˜è¿™ä¸ªå‡½æ•°çš„æ€§èƒ½

```js
const cache = {}

const mult = (...args) => {
  let key = args.join(',')
  if (cache[key]) {
    return cache[key]
  }
  let val = 1
  for (let i = 0; i < args.length; i++) {
    val *= args[i]
  }
  return cache[key] = val
}
```

`cache`è¿™ä¸ªå˜é‡ä»…ä»…åœ¨`mult`å‡½æ•°ä¸­è¢«ä½¿ç”¨ï¼Œå°†å…¶å°é—­åœ¨`mult`å‡½æ•°å†…éƒ¨ã€‚

```js
const mult = () => {
  const cache = {}
  return function (...args) {
    let key = args.join(',')
    if (key in cache) {
      return cache[key]
    }
    let val = 1
    for (let i = 0; i < args.length; i++) {
      val *= args[i]
    }
    return cache[key] = val
  }
}
```

æç‚¼å‡½æ•°æ˜¯ä»£ç é‡æ„ä¸­çš„å¸¸è§æŠ€å·§ï¼Œå¦‚æœåœ¨ä¸€ä¸ªå¤§å‡½æ•°ä¸­æœ‰ä¸€äº›ä»£ç å—èƒ½å¤Ÿç‹¬ç«‹å‡ºæ¥ï¼Œå¸¸å¸¸æŠŠè¿™äº›ä»£ç å—å°è£…åœ¨ç‹¬ç«‹çš„å°å‡½æ•°é‡Œé¢ã€‚ç‹¬ç«‹å‡ºæ¥çš„å°å‡½æ•°æœ‰åŠ©äºä»£ç å¤ç”¨ï¼Œå¦‚æœè¿™äº›å°å‡½æ•°æœ‰ä¸€ä¸ªè‰¯å¥½çš„å‘½åï¼Œå®ƒä»¬æœ¬èº«ä¹Ÿèµ·åˆ°äº†æ³¨é‡Šçš„ä½œç”¨ã€‚

```js
const mult = () => {
  const cache = {}
  const calculate = (...args) => {
    let val = 1
    for (let i = 0; i < args.length; i++) {
      val *= args[i]
    }
    return val
  }
  return function (...args) {
    let key = args.join(',')
    if (key in cache) {
      return cache[key]
    }
    return cache[key] = calculate.apply(null, args)
  }
}
```

#### é«˜é˜¶å‡½æ•°

é«˜é˜¶å‡½æ•°å¼æŒ‡è‡³å°‘æ»¡è¶³ä¸‹åˆ—æ¡ä»¶ä¹‹ä¸€çš„å‡½æ•°

+ å‡½æ•°å¯ä»¥ä½œä¸ºå‚æ•°ä¼ é€’
+ å‡½æ•°å¯ä»¥ä½œä¸ºè¿”å›å€¼è¾“å‡º

å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œä»£è¡¨å¯ä»¥æŠ½ç¦»ä¸€éƒ¨åˆ†å®¹æ˜“å˜åŒ–çš„ä¸šåŠ¡é€»è¾‘ï¼Œå°†è¿™éƒ¨åˆ†ä¸šåŠ¡é€»è¾‘æ”¾åœ¨å‡½æ•°å‚æ•°ä¸­ï¼Œå›è°ƒå‡½æ•°å°±æ˜¯ä¸€ä¸ªé‡è¦çš„åº”ç”¨åœºæ™¯ã€‚

##### å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’

1.å›è°ƒå‡½æ•°

ç›´æ¥çœ‹ğŸŒ°

åœ¨é¡µé¢ä¸­åˆ›å»º100ä¸ªdivèŠ‚ç‚¹ï¼Œç„¶åå°†è¿™äº›èŠ‚ç‚¹è®¾ç½®ä¸ºéšè—

```js
const appendDiv = function() {
  for(let i = 0; i < 100; i++) {
    const div = document.createElement('div')
    div.innerHTML = i
    document.body.appendChild(div)
    div.style.display = 'none'
  }
}

appendDiv()
```

å°†`div.style.display = 'none'`æ”¾åœ¨å‡½æ•°ä¸­æ˜¯ä¸åˆç†çš„ï¼Œè¿™ä¸ªå‡½æ•°è¿‡äº"ä¸ªæ€§åŒ–"ï¼Œéš¾ä»¥å¤ç”¨ï¼Œè¿™æ ·æ”¹é€ :

```js
const appendDiv = function(callback) {
  for (let i = 0; i < 100; i++) {
    const div = document.createElement('div')
    div.innerHTML = i
    document.body.appendChild(div)
    if (typeof callback === 'function') {
      callback(div)
    }
  }
}

appendDiv(node => {
  node.style.display = 'none'
})
```

2.Array.prototype.sort

æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¿™ä¸ªå‡½æ•°é‡Œå°è£…äº†æ•°ç»„å…ƒç´ çš„æ’åºè§„åˆ™

##### å‡½æ•°ä½œä¸ºè¿”å›å€¼è¾“å‡º

è¿™æ˜¯ä¸€ä¸ªå•ä¾‹æ¨¡å¼çš„ğŸŒ°

```js
const getSingle = function(fn) {
  let ret
  return function(...args) {
    return ret || (ret = fn.apply(this, args))
  }
}
```

##### é«˜é˜¶å‡½æ•°å®ç°AOP

AOP(é¢å‘åˆ‡é¢ç¼–ç¨‹)çš„ä¸»è¦ä½œç”¨æ˜¯æŠŠä¸€äº›è·Ÿæ ¸å¿ƒä¸šåŠ¡é€»è¾‘æ— å…³çš„åŠŸèƒ½æŠ½ç¦»å‡ºæ¥ï¼Œé€šå¸¸åŒ…æ‹¬æ—¥å¿—åŒçº§ã€å®‰å…¨æ§åˆ¶ã€å¼‚å¸¸å¤„ç†ã€‚è¿™æ ·åšçš„å¥½å¤„æ˜¯ä¿æŒä¸šåŠ¡é€»è¾‘æ¨¡å—çš„çº¯å‡€å’Œé«˜å†…èšæ€§ã€‚

åœ¨JavaScriptä¸­å®ç°AOPï¼Œé€šå¸¸æ˜¯æŠŠä¸€ä¸ªå‡½æ•°"åŠ¨æ€ç»‡å…¥"åˆ°å¦å¤–ä¸€ä¸ªå‡½æ•°ä¹‹ä¸­ã€‚

```js
Function.prototype.before = function(beforefn) {
  const __self = this // ä¿å­˜åŸå‡½æ•°çš„å¼•ç”¨
  return function(...args) {
    beforefn.apply(this, args)
    return __self.apply(this, args)
  }
}

Function.prototype.after = function(afterfn) {
  const __self = this
  return function(...args) {
    let ret = __self.apply(this, args)
    afterfn.apply(this, args)
    return ret
  }
}

const func = function() {
  console.log(2)
}

const funcAOP = func.before(function() {
  console.log(1)
}).after(function() {
  console.log(3)
})

funcAOP()
```

è¿™æ˜¯è£…é¥°è€…æ¨¡å¼å®ç°ã€‚

##### é«˜é˜¶å‡½æ•°çš„å…¶ä»–åº”ç”¨

1.currying

`currying`åˆç§°éƒ¨åˆ†æ±‚å€¼ã€‚ä¸€ä¸ª`currying`çš„å‡½æ•°é¦–å…ˆä¼šæ¥æ”¶ä¸€äº›å‚æ•°ï¼Œæ¥æ”¶è¿™äº›å‚æ•°ä¹‹åï¼Œè¯¥å‡½æ•°ä¸ä¼šç«‹å³æ±‚å€¼ï¼Œè€Œæ˜¯ç»§ç»­è¿”å›å¦å¤–ä¸€ä¸ªå‡½æ•°ï¼Œåˆšæ‰ä¼ å…¥çš„å‚æ•°åœ¨å‡½æ•°å½¢æˆçš„é—­åŒ…ä¸­è¢«ä¿å­˜èµ·æ¥ã€‚å¾…åˆ°å‡½æ•°çœŸæ­£éœ€è¦æ±‚å€¼çš„æ—¶å€™ï¼Œä¹‹å‰ä¼ å…¥çš„æ‰€æœ‰å‚æ•°éƒ½ä¼šè¢«ä¸€æ¬¡æ€§ç”¨äºæ±‚å€¼ã€‚

2.uncurrying

3.å‡½æ•°èŠ‚æµ

ä¸‹åˆ—åœºæ™¯

+ window.onsizeäº‹ä»¶
+ mousemoveäº‹ä»¶
+ ä¸Šä¼ è¿›åº¦

4.åˆ†æ—¶å‡½æ•°

åœºæ™¯:åœ¨WebQQå¥½å‹åˆ—è¡¨ä¸­ï¼Œå¯èƒ½ä¸€æ¬¡æ€§å¾€é¡µé¢ä¸­æ·»åŠ åƒæ•°é‡çº§çš„èŠ‚ç‚¹ã€‚

`timeChunk`å‡½æ•°è®©åˆ›å»ºèŠ‚ç‚¹çš„å·¥ä½œåˆ†æ‰¹è¿›è¡Œï¼Œæ¯”å¦‚ä¸€ç§’åˆ›å»º1000ä¸ªæ”¹ä¸ºæ¯éš”200æ¯«ç§’åˆ›å»º200ä¸ªã€‚

```js
const timeChunk = function(array, fn, count) {
  const start = function() {
    for(let i = 0; i < Math.min(count || 1, array.length); i++) {
      let obj = array.shift()
      fn(obj)
    }
  }

  return function() {
    let t = setInterval(() => {
      if (array.length === 0) {
        return clearInterval(t)
      }
      start()
    }, 200)
  }
}
```

5.æƒ°æ€§åŠ è½½å‡½æ•°

é¿å…æ¯æ¬¡éƒ½è®©ç¨‹åºæ‰§è¡Œåˆ¤æ–­è¿‡ç¨‹

```js
const addEvent = (() => {
  if (window.addEventListener) {
    return function(elem, type, handler) {
      elem.addEventListener(type, handler, flase)
    }
  }
  if (window.attachEvent) {
    return function(elem, type, handler) {
      elem.attachEvent(`on${type}`, handler)
    }
  }
})()
```

å¯¹äºè¿™ä¸ªåœºæ™¯è¿˜æœ‰è¿™ç§è§£å†³ï¼Œå³åœ¨è°ƒç”¨è¿‡ç¨‹ä¸­æ”¹å†™å‡½æ•°ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯å‡å°‘åˆå§‹åŒ–å¼€é”€

```js
let addEvent = function(elem, type, handler) {
  if (window.addEventListener) {
    addEvent = function(elem, type, handler) {
      elem.addEventListener(type, handler, flase)
    }
  } else if (window.attachEvent) {
    addEvent = function(elem, type, handler) {
      elem.attachEvent(`on${type}`, handler)
    }
  }

  addEvent(elem, type, handler)
}
```

## ç¬¬äºŒéƒ¨åˆ† è®¾è®¡æ¨¡å¼

### ç¬¬4ç«  å•ä¾‹æ¨¡å¼(Singleton Pattern)

> Ensure a class has only one instance, and provide a global point of access to it.ï¼ˆä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚ï¼‰

å•ä¾‹æ¨¡å¼æ˜¯ä¸€ç§å¸¸ç”¨çš„æ¨¡å¼ï¼Œæœ‰äº›å¯¹è±¡å¾€å¾€åªéœ€è¦ä¸€ä¸ªã€‚æ¯”å¦‚Toastã€‚

#### å®ç°å•ä¾‹æ¨¡å¼

ä½¿ç”¨ä¸€ä¸ªå˜é‡æ¥æ ‡å¿—å½“å‰æ˜¯å¦å·²ç»ä¸ºæŸä¸ªç±»åˆ›å»ºè¿‡å¯¹è±¡ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™åœ¨ä¸‹ä¸€æ¬¡è·å–è¯¥ç±»çš„å®ä¾‹æ—¶ï¼Œç›´æ¥è¿”å›ä¹‹å‰åˆ›å»ºçš„å¯¹è±¡ã€‚

```js
class Singleton {
  constructor(name) {
    this.name = name
    this.instance = null
  }

  getName() {
    console.log(this.name)
  }

  getInstance(name) {
    if(!this.instance) {
      this.instance = new Singleton(name)
    }
    return this.instance
  }
}
```

æˆ–è€…

```js
const Singleton = function(name) {
  this.name = name
}

Singleton.prototype.getName = function() {
  console.log(this.name)
}

Singleton.getInstance = (function(name) {
  let instance = null
  return function() {
    if (!this.instance) {
      instance = new Singleton(name)
    }
    return instance
  }
})()
```

ä»¥ä¸Šä¸¤ç§æ–¹å¼ä¸­ï¼Œä½¿ç”¨`Singleton.getInstance`æ¥è·å–`Singleton`ç±»çš„å”¯ä¸€å¯¹è±¡ï¼Œä½†æ˜¯å¢åŠ äº†è¿™ä¸ªç±»çš„"ä¸é€æ˜æ€§"ã€‚

#### é€æ˜çš„å•ä¾‹æ¨¡å¼

```js
const CreateDiv = (function() {
  let instance

  const CreateDiv = function(html) {
    if (instance) {
      return instance
    }
    this.html = html
    this.init()
    return instance = this
  }

  CreateDiv.prototype.init = function() {
    let div = document.createElement('div')
    div.innerHTML = this.html
    document.body.appendChild(div)
  }

  return CreateDiv
})()

let a = new CreateDiv('1')
let b = new CreateDiv('2')

console.log(a === b)
```

ä½¿ç”¨äº†é—­åŒ…ä¿å­˜å•ä¾‹ï¼Œç«‹å³æ‰§è¡Œå‡½æ•°è¿”å›çœŸæ­£çš„æ„é€ æ–¹æ³•ã€‚

ç°åœ¨çš„æ„é€ å‡½æ•°å®é™…ä¸Šè´Ÿè´£äº†ä¸¤ä»¶äº‹æƒ…ã€‚ç¬¬ä¸€æ˜¯åˆ›å»ºå¯¹è±¡å’Œæ‰§è¡Œåˆå§‹åŒ–initæ–¹æ³•ï¼Œç¬¬äºŒæ˜¯ä¿è¯åªæœ‰ä¸€ä¸ªå¯¹è±¡

```js
const CreateDiv = function(html) {
  if (instance) {
    return instance
  }
  this.html = html
  this.init()
  return instance = this
}
```

#### ç”¨ä»£ç†å®ç°å•ä¾‹æ¨¡å¼

å¼•å…¥ä»£ç†ç±»ï¼Œå°†è´Ÿè´£ç®¡ç†å•ä¾‹çš„ä»£ç æ”¾è¿›å»ã€‚

```js
const CreateDiv = function(html) {
  this.html = html
  this.init()
}

CreateDiv.prototype.init = function() {
  let div = document.createElement('div')
  div.innerHTML = this.html
  document.body.appendChild(div)
}

const ProxySingletonCreateDiv = (function() {
  let instance
  return function(html) {
    if (!instance) {
      instance = new CreateDiv(html)
    }
    return instance
  }
})()

const a = new ProxySingletonCreateDiv('hehe')
const b = new ProxySingletonCreateDiv('haha')
```

#### JavaScriptä¸­çš„å•ä¾‹æ¨¡å¼

JavaScriptå…¶å®æ˜¯ä¸€é—¨æ— ç±»(class-free)è¯­è¨€ã€‚

> å•ä¾‹æ¨¡å¼çš„æ ¸å¿ƒæ˜¯ç¡®ä¿åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›å…¨å±€è®¿é—®ã€‚

åœ¨JavaScriptå¼€å‘ä¸­ï¼Œä¼šæŠŠå…¨å±€å˜é‡å½“æˆå•ä¾‹æ¥ä½¿ç”¨ã€‚

```js
var a = {};
```

å…¨å±€å˜é‡å­˜åœ¨å¾ˆå¤šé—®é¢˜ï¼Œå®¹æ˜“é€ æˆå‘½åç©ºé—´æ±¡æŸ“ã€‚å¤§ä¸­å‹é¡¹ç›®ä¸­å®¹æ˜“å‡ºç°é—®é¢˜ã€‚

æœ‰ä¸¤ç§æ–¹å¼*é™ä½*å…¨å±€å˜é‡å¸¦æ¥çš„å‘½åæ±¡æŸ“ã€‚

+ ä½¿ç”¨å‘½åç©ºé—´
+ é—­åŒ…

```js
// å‘½åç©ºé—´
const namespace = {
  a: function() {
    alert(1);
  },
  b: function() {
    alert(2);
  }
}
```

å‡å°‘å˜é‡å’Œå…¨å±€ä½œç”¨åŸŸæ‰“äº¤é“çš„æœºä¼šã€‚

```js
const user = (function() {
  let __name = 'myoung',
      __age = 23;

  return {
    getUserInfo: function() {
      return `${__name}-${__age}`;
    }
  }
})();
```

#### æƒ°æ€§å•ä¾‹

åœ¨éœ€è¦çš„æ—¶å€™æ‰åˆ›å»ºå¯¹è±¡å®ä¾‹ã€‚æƒ°æ€§å•ä¾‹æ˜¯å•ä¾‹æ¨¡å¼çš„é‡ç‚¹ã€‚

```js
const createLoginLayer = (function() {
  let div;
  return function() {
    if (!div) {
      div = document.createElement("div");
      div.innerHTML = "æˆ‘æ˜¯ç™»å½•æµ®çª—";
      div.style.display = "none";
      document.body.appendChild(div);
    }
    return div;
  };
})();
```

è¿™æ®µä»£ç çš„é—®é¢˜

+ è¿åå•ä¸€èŒè´£åŸåˆ™ï¼Œåˆ›å»ºå¯¹è±¡å’Œç®¡ç†å•ä¾‹çš„é€»è¾‘éƒ½æ”¾åœ¨`createLoginLayer`ä¸­
+ ä¸‹æ¬¡å†éœ€è¦åˆ›å»ºå•ä¾‹çš„æ—¶å€™ï¼Œè¿˜æ˜¯ä¸€æ ·çš„æ€è·¯ï¼Œ`createLoginLayer`ç…§æŠ„ä¸€é

éœ€è¦å°†ç›¸åŒçš„é€»è¾‘æŠ½è±¡å‡ºæ¥

```js
var obj
if (!obj) {
  obj = xxx;
}
```

```js
const getSingle = function(fn) {
  let result;
  return function() {
    return result || (result = fn.apply(this, arguments));
  }
}
```

äºæ˜¯è¿™ä¹ˆå»ç”¨

```js
const createLoginLayer = function() {
  div = document.createElement("div");
  div.innerHTML = "æˆ‘æ˜¯ç™»å½•æµ®çª—";
  div.style.display = "none";
  document.body.appendChild(div);
  return div;
};

const createSingleLoginLayer = getSingle(createLoginLayer)

document.getElementById('loginBtn').onclick = function() {
  const loginLayer = createSingleLoginLayer();
  loginLayer.style.display = 'block';
};
```

### ç¬¬5ç«  ç­–ç•¥æ¨¡å¼(Strategy Pattern)

> Define a family of algorithms, encapsulate each one, and make them interchangeable.ï¼ˆå®šä¹‰ä¸€ç»„ç®—æ³•ï¼Œå°†æ¯ä¸ªç®—æ³•éƒ½å°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿ä»–ä»¬ä¹‹é—´å¯ä»¥äº’æ¢ã€‚ï¼‰

åˆ°åŒä¸€ä¸ªç›®çš„åœ°å¯ä»¥æœ‰å¤šç§é€”å¾„ï¼Œæ ¹æ®å®é™…æƒ…å†µæ¥é€‰æ‹©å‡ºè¡Œçš„çº¿è·¯ã€‚

#### ä½¿ç”¨ç­–ç•¥æ¨¡å¼è®¡ç®—å¥–é‡‘

1.çœ‹ä¸€ä¸ªç»©æ•ˆè€ƒæ ¸çš„ä¾‹å­

```js
const calculateBonus = function(performanceLevel, salary) {
  if (performanceLevel === 'S') {
    return salary * 4;
  }

  if (performanceLevel === 'A') {
    return salary * 3;
  }

  if (performanceLevel === 'B') {
    return salary * 2;
  }
}

calculateBonus('B', 20000); // 40000
calculateBonus('S', 6000); // 24000
```

é—®é¢˜æ˜¾è€Œæ˜“è§:

+ `calculateBonus`å‡½æ•°åºå¤§ï¼ŒåŒ…å«å¾ˆå¤š`if-else`è¯­å¥ï¼Œè¿™äº›è¯­å¥éœ€è¦è¦†ç›–æ‰€æœ‰çš„é€»è¾‘åˆ†æ”¯ã€‚
+ `calculateBonus`å‡½æ•°ç¼ºä¹å¼¹æ€§ï¼Œå¦‚æœå¢åŠ äº†ä¸€ç§æ–°çš„ç»©æ•ˆç­‰çº§Cï¼Œæˆ–è€…ç»©æ•ˆSçš„è®¡ç®—é€»è¾‘æ”¹å˜ï¼Œå¿…é¡»è¦ä¿®æ”¹å…¶å†…éƒ¨å®ç°ï¼Œè¿åå¼€æ”¾-å°é—­åŸåˆ™ã€‚
+ ç®—æ³•å¤ç”¨æ€§å·®ã€‚

2.ä½¿ç”¨ç»„åˆå‡½æ•°é‡æ„

```js
const performanceS = function(salary) {
  return salary * 4;
}

const performanceA = function(salary) {
  return salary * 3;
}

const performanceB = function(salary) {
  return salary * 2;
}

const calculateBonus = function(performanceLevel, salary) {
  if (performanceLevel === 'S') {
    return performanceS(salary);
  }

  if (performanceLevel === 'A') {
    return performanceA(salary);
  }

  if (performanceLevel === 'B') {
    return performanceB(salary);
  }
}

calculateBonus('A', 10000); // 30000
```

æ²¡æœ‰è§£å†³`calculateBonus`å‡½æ•°ä¼šè¶Šæ¥è¶Šå¤§çš„é—®é¢˜ï¼Œåœ¨ç³»ç»Ÿå˜åŒ–çš„æ—¶å€™ç¼ºä¹å¼¹æ€§ã€‚

3.ä½¿ç”¨ç­–ç•¥æ¨¡å¼é‡æ„

> ç­–ç•¥æ¨¡å¼çš„ç›®çš„å°±æ˜¯å°†ç®—æ³•çš„ä½¿ç”¨ä¸ç®—æ³•çš„å®ç°éƒ¨åˆ†åˆ†ç¦»å¼€æ¥ã€‚

åœ¨è®¡ç®—å¥–é‡‘çš„è¿™ä¸ªä¾‹å­ä¸­ï¼Œç®—æ³•çš„ä½¿ç”¨æ–¹å¼æ˜¯ä¸å˜çš„ï¼Œéƒ½æ˜¯æ ¹æ®æŸä¸ªç®—æ³•å–å¾—è®¡ç®—åçš„å¥–é‡‘æ•°é¢ã€‚è€Œç®—æ³•çš„å®ç°æ˜¯å˜åŒ–çš„ã€‚

> ä¸€ä¸ªåŸºäºç­–ç•¥æ¨¡å¼çš„ç¨‹åºè‡³å°‘æœ‰ä¸¤éƒ¨åˆ†ç»„æˆã€‚ç¬¬ä¸€ä¸ªéƒ¨åˆ†æ˜¯ä¸€ç»„ç­–ç•¥ç±»ï¼Œç­–ç•¥ç±»å°è£…äº†å…·ä½“çš„ç®—æ³•ï¼Œå¹¶è´Ÿè´£å…·ä½“çš„è®¡ç®—è¿‡ç¨‹ã€‚ç¬¬äºŒä¸ªéƒ¨åˆ†æ˜¯ç¯å¢ƒç±»Contextï¼ŒContextæ¥å—å®¢æˆ·ç«¯è¯·æ±‚ï¼ŒéšåæŠŠè¯·æ±‚å§”æ‰˜ç»™æŸä¸€ä¸ªç­–ç•¥ç±»ã€‚Contextä¸­è¦ç»´æŒå¯¹æŸä¸ªç­–ç•¥å¯¹è±¡çš„å¼•ç”¨ã€‚

```js
class PerformanceS {
  calculate(salary) {
    return salary * 4;
  }
}

class PerformanceA {
  calculate(salary) {
    return salary * 3;
  }
}

class PerformanceB {
  calculate(salary) {
    return salary * 4;
  }
}

class Bonus {
  constructor(salary = null, strategy = null) {
    this.salary = salary
    this.strategy = strategy

    this.setSalary = this.setSalary.bind(this)
    this.setStrategy = this.setStrategy.bind(this)
    this.getBonus = this.getBonus.bind(this)
  }

  setSalary(salary) {
    this.salary = salary
  }

  setStrategy(strategy) {
    this.strategy = strategy
  }

  getBonus() {
    return this.strategy.calculate(this.salary)
  }
}

const bonus = new Bonus()

bonus.setSalary(10000)
bonus.setStrategy(new PerformanceS())

console.log(bonus.getBonus()) // 40000

bonus.setStrategy(new PerformanceA())
console.log(bonus.getBonus()) // 30000
```

åœ¨å¯¹ç¯å¢ƒç±»`Context`(è¿™é‡Œæ˜¯Bonus)å‘èµ·è¯·æ±‚çš„æ—¶å€™ï¼Œ`Context`æŠŠè¯·æ±‚å§”æ‰˜ç»™è¿™äº›ç­–ç•¥å¯¹è±¡ä¸­é—´çš„æŸä¸€ä¸ªè¿›è¡Œè®¡ç®—ã€‚

#### JavaScriptç‰ˆæœ¬çš„ç­–ç•¥æ¨¡å¼

```js
const strategies = {
  S(salary) {
    return salary * 4
  },
  A(salary) {
    return salary * 3
  },
  B(salary) {
    return salary * 2
  },
};

const calculateBonus = function(level, salary) {
  return strategies[level](salary)
}

console.log(calculateBonus('S', 2000))
console.log(calculateBonus('A', 10000))
```

#### è¡¨å•æ ¡éªŒçš„ä¾‹å­

è¡¨å•éªŒè¯ä¸­å¸¸è§çš„ç¼–ç æ–¹å¼ï¼Œåˆ†æ”¯è¿‡å¤šï¼Œç»´æŠ¤æ€§å·®ï¼Œå¤ç”¨æ€§å·®ã€‚

```js
if (registerForm.userName.value === '') {
  alert('ç”¨æˆ·åä¸èƒ½ä¸ºç©º');
  return false;
}
if (registerForm.password.value.length < 6) {
  alert('å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½');
  return false;
}
if (!/^1(3|5|8)[0-9]{9}$/.test(registerForm.phoneNumber.value)) {
  alert('æ‰‹æœºå·ç æ ¼å¼ä¸æ­£ç¡®');
  return false;
}
```

ä¸‹é¢ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ”¹å†™

```js
const strategies = {
  isNonEmpty(value, errorMsg) {
    if (value === '') {
      return errorMsg
    }
  },
  minLength(value, length, errorMsg) {
    if (value.length < length) {
      return errorMsg
    }
  },
  isMobile(value, errorMsg) {
    if (!/^1(3|5|8)[0-9]{9}$/.test(value)) {
      return errorMsg
    }
  }
}

// éªŒè¯è°ƒç”¨
const validataFunc = function() {
  const validator = new Validator()

  validator.add(registerForm.userName, 'isNonEmpty', 'ç”¨æˆ·åä¸èƒ½ä¸ºç©º')
  validator.add(registerForm.password, 'minLength:6', 'å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½')
  validator.add(registerForm.phoneNumber, 'isMobile', 'æ‰‹æœºå·ç æ ¼å¼ä¸æ­£ç¡®')

  let errorMsg = validator.start()
  return errorMsg
}

class Validator {
  constructor() {
    this.cache = []
    this.add = this.add.bind(this)
    this.start = this.start.bind(this)
  }

  add(dom, rule, errorMsg) {
    const ary = rule.split(':')
    this.cache.push(function() {
      const strategy = ary.shift()
      ary.unshift(dom.value)
      ary.push(errorMsg)
      return strategies[strategy].apply(dom, ary)
    })
  }

  start() {
    for (let i = 0, validataFunc; validataFunc = this.cache[i++];) {
      let msg = validataFunc()
      if (msg) {
        return msg
      }
    }
  }
}
```

å¤§è‡´å®ç°æ€è·¯å¦‚æ­¤ï¼Œå¯å°†å…¶æ”¹å†™ä¸ºä¸€ä¸ªè¾“å…¥æ¡†æ”¯æŒå¤šæ¡éªŒè¯è§„åˆ™ï¼Œè¯¦è§84é¡µã€‚

### ç¬¬6ç«  ä»£ç†æ¨¡å¼(Proxy pattern)

Proxy patternï¼ˆä»£ç†æ¨¡å¼ï¼‰ï¼šProvide a surrogate (ä»£ç†) or placeholder for another object to control access to it.ï¼ˆä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ç§ä»£ç†ä»¥æ§åˆ¶å¯¹è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ã€‚ï¼‰

> ä»£ç†æ¨¡å¼æ˜¯ä¸ºä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç”¨å“æˆ–å ä½ç¬¦ï¼Œä»¥ä¾¿æ§åˆ¶å¯¹å®ƒçš„è®¿é—®ã€‚

æ˜æ˜Ÿæœ‰ç»çºªäººä½œä¸ºä»£ç†ï¼Œè¯·æ˜æ˜Ÿæ¼”å‡ºåªèƒ½è”ç³»ç»çºªäººï¼Œç»çºªäººæŠŠç»†èŠ‚æŠ¥é…¬è°ˆå¥½å†æŠŠåˆåŒäº¤ç»™æ˜æ˜Ÿã€‚

ä»£ç†æ¨¡å¼çš„å…³é”®æ˜¯ï¼Œå½“å®¢æˆ·ä¸æ–¹ä¾¿ç›´æ¥è®¿é—®ä¸€ä¸ªå¯¹è±¡æˆ–è€…ä¸æ»¡è¶³éœ€è¦çš„æ—¶å€™ï¼Œæä¾›ä¸€ä¸ªæ›¿èº«å¯¹è±¡æ¥æ§åˆ¶è¿™ä¸ªå¯¹è±¡çš„è®¿é—®ï¼Œå®¢æˆ·å®é™…ä¸Šè®¿é—®çš„æ˜¯æ›¿èº«å¯¹è±¡ã€‚æ›¿èº«å¯¹è±¡å¯¹è¯·æ±‚åšå‡ºä¸€äº›å¤„ç†ä¹‹åï¼Œå†æŠŠè¯·æ±‚è½¬äº¤ç»™æœ¬ä½“å¯¹è±¡ã€‚

ä¿æŠ¤ä»£ç†ç”¨äºæ§åˆ¶ä¸åŒæƒé™çš„å¯¹è±¡å¯¹ç›®æ ‡å¯¹è±¡çš„è®¿é—®ã€‚

#### è™šæ‹Ÿä»£ç†å®ç°å›¾ç‰‡é¢„åŠ è½½

```js
const myImage = (function() {
  const imgNode = document.createElement('img')
  document.body.appendChild(imgNode)

  return {
    setSrc: function(src) {
      imgNode.src = src
    }
  }
})()

const proxyImage = (function() {
  const img = new Image()
  img.onload = function() {
    myImage.setSrc(this.src)
  }
  return {
    setSrc(src) {
      myImage.setSrc('loading.gif')
      img.src = src
    }
  }
})()

proxyImage.setSrc('hehe.jpg')
```

ä¸‹é¢æ˜¯æ²¡æœ‰å¼•å…¥ä»£ç†çš„ä»£ç 

```js
const MyImage = (function() {
  const imgNode = document.createElement('img')
  document.body.appendChild(imgNode)
  const img = new Image()

  img.onload = function() {
    imgNode.src = img.src
  }

  return {
    setSrc: function(src) {
      imgNode.src = 'loading.gif'
      img.src = src
    }
  }
})()

MyImage.setSrc('hehe.jpg')
```

å•ä¸€èŒè´£åŸåˆ™ï¼Œå¦‚æœä¸€ä¸ªå¯¹è±¡çš„èŒè´£è¿‡å¤šï¼Œç­‰äºå°†å¾ˆå¤šèŒè´£è€¦åˆåˆ°ä¸€èµ·ï¼Œå¯¼è‡´ä½å†…èšçš„è®¾è®¡ã€‚æ‰€ä»¥è¿™é‡Œä½¿ç”¨ä»£ç†å°†é¢„åŠ è½½å’Œè¯·æ±‚å›¾ç‰‡èŒè´£åˆ†ç¦»ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä»£ç†å’Œæœ¬ä½“æ¥å£éœ€è¦ä½“ç°ä¸€è‡´æ€§ï¼Œå¯¹ç”¨æˆ·æ¥è¯´æ˜¯é€æ˜çš„ï¼Œå¹¶ä¸çŸ¥é“ä»£ç†å’Œæœ¬ä½“çš„åŒºåˆ«ã€‚

#### è™šæ‹Ÿä»£ç†åˆå¹¶HTTPè¯·æ±‚

é€šè¿‡ä»£ç†å‡½æ•°æ¥æ”¶é›†ä¸€æ®µæ—¶é—´ä¹‹å†…çš„è¯·æ±‚ï¼Œç„¶åä¸€æ¬¡æ€§å‘ç»™æœåŠ¡å™¨ã€‚

```js
const synchronousFile = function(id) {
  console.log(`å¼€å§‹åŒæ­¥æ–‡ä»¶ï¼Œidä¸º${id}`)
}

const proxySynchronousFile = (function() {
  const cache = []
  let timer

  return function(id) {
    cache.push(id)
    if (timer) {
      return
    }

    timer = setTimeout(function() {
      synchronousFile(cache.join(','))
      clearTimeout(timer)
      timer = null
      cache.length = 0
    }, 2000)
  }
})()

let checkbox = document.getElementsByTagName('input')

for (let i = 0, c; c = checkbox[i++]; ) {
  c.onclick = function() {
    if (this.checked === true) {
      proxySynchronousFile(this.id)
    }
  }
}
```

#### ç¼“å­˜ä»£ç†

ç¼“å­˜ä»£ç†å¯ä»¥ä¸ºä¸€äº›å¼€é”€å¤§çš„è¿ç®—ç»“æœæä¾›æš‚æ—¶çš„å­˜å‚¨ï¼Œä¸‹æ¬¡è¿ç®—æ—¶ï¼Œå¦‚æœä¼ é€’è¿›æ¥çš„å‚æ•°è·Ÿä¹‹å‰çš„ä¸€è‡´ï¼Œåˆ™å¯ä»¥ç›´æ¥è¿”å›å‰é¢å­˜å‚¨çš„è¿ç®—ç»“æœã€‚

```js
const mult = function(...args) {
  console.log('å¼€å§‹è®¡ç®—ä¹˜ç§¯')
  let a = 1
  for (let i = 0; i < args.length; i++) {
    a *= args[i]
  }
  return a
}

const proxyMult = (function() {
  const cache = {}
  return function(...args) {
    let key = args.join(',')
    if (cache[key]) {
      return cache[key]
    }
    return cache[key] = mult.apply(this, args)
  }
})()

proxyMult(1, 2, 3, 4)
proxyMult(1, 2, 3, 4)
```

è¿™é‡Œå¯ä»¥å°†ç¼“å­˜æŠ½ç¦»å‡ºæ¥ä¸€ä¸ªé«˜é˜¶å‡½æ•°

```js
const createProxyFactory = function(fn) {
  const cache = {}
  return function(...args) {
    let key = args.join(',')
    if (cache[key]) {
      return cache[key]
    }
    return cache[key] = fn.apply(this, args)
  }
}
```

### ç¬¬7ç«  è¿­ä»£å™¨æ¨¡å¼(Iterator Pattern)

Provide a way to access the elements of an aggregate object sequentially without exposing its underlying representation.ï¼ˆå®ƒæä¾›ä¸€ç§æ–¹æ³•è®¿é—®ä¸€ä¸ªå®¹å™¨å¯¹è±¡ä¸­å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸éœ€è¦æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚ã€‚ï¼‰

> è¿­ä»£å™¨æ¨¡å¼æ˜¯æŒ‡æä¾›ä¸€ç§æ–¹æ³•é¡ºåºè®¿é—®ä¸€ä¸ªèšåˆå¯¹è±¡ä¸­çš„å„ä¸ªå…ƒç´ ï¼Œè€Œåˆä¸éœ€è¦æš´éœ²è¯¥å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚åŠä¸ç”¨å…³å¿ƒå¯¹è±¡çš„å†…éƒ¨æ„é€ ï¼Œä¹Ÿå¯ä»¥æŒ‰é¡ºåºè®¿é—®å…¶ä¸­çš„æ¯ä¸ªå…ƒç´ ã€‚

### ç¬¬8ç«  å‘å¸ƒ-è®¢é˜…æ¨¡å¼(Observer Pattern)

Define a one-to-many dependency between objects so that when one object changes state, all its dependents are notified and updated automatically.ï¼ˆå®šä¹‰å¯¹è±¡é—´ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œä½¿å¾—æ¯å½“ä¸€ä¸ªå¯¹è±¡æ”¹å˜çŠ¶æ€ï¼Œåˆ™æ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½ä¼šå¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚ï¼‰

> å‘å¸ƒ-è®¢é˜…æ¨¡å¼åˆå«åšè§‚å¯Ÿè€…æ¨¡å¼ï¼Œå®ƒå®šä¹‰å¯¹è±¡é—´çš„ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°é€šçŸ¥ã€‚åœ¨JavaScriptå¼€å‘ä¸­ï¼Œä¸€èˆ¬ç”¨äº‹ä»¶æ¨¡å‹æ¥æ›¿ä»£ä¼ ç»Ÿçš„å‘å¸ƒ-è®¢é˜…æ¨¡å¼ã€‚

å‘å¸ƒè®¢é˜…æ¨¡å¼çš„é€šç”¨å®ç°

```js
const event = {
  clientList: [], // ç¼“å­˜åˆ—è¡¨ï¼Œå­˜æ”¾è®¢é˜…è€…çš„å›è°ƒå‡½æ•°
  listen(key, fn) {
    if (!this.clientList[key]) {
      this.clientList[key] = []
    }
    this.clientList[key].push(fn)
  },
  trigger(...args) {
    const key = args.shift()
    const fns = this.clientList[key]

    if (!fns || fns.length === 0) {
      return false
    }

    for (let i = 0, fn; fn = fns[i++];) {
      fn.apply(this, args)
    }
  }
}

// ç»™å¯¹è±¡åŠ¨æ€æ·»åŠ èŒè´£ï¼Œç»™å¯¹è±¡åŠ¨æ€æ·»åŠ å‘å¸ƒ-è®¢é˜…åŠŸèƒ½
const installEvent = function(obj) {
  for (let i of Object.keys(event)) {
    obj[i] = event[i]
  }
}
```

è¿™é‡Œæ˜¯è°ƒç”¨çš„ä¾‹å­

```js
const salesOffices = {}
installEvent(salesOffices)

salesOffices.listen('squareMeter88', function(price) {
  console.log(`ä»·æ ¼= ${price}`)
})

salesOffices.listen('squareMeter100', function(price) {
  console.log(`ä»·æ ¼= ${price}`)
})

salesOffices.trigger('squareMeter88', 2000000)
salesOffices.trigger('squareMeter100', 3000000)
```

é—®é¢˜åœ¨äºå‘å¸ƒè®¢é˜…è€…å­˜åœ¨ä¸€å®šè€¦åˆæ€§ï¼Œéœ€è¦çŸ¥é“å¯¹è±¡çš„åç§°æ‰èƒ½é¡ºåˆ©è®¢é˜…äº‹ä»¶ã€‚

#### å…¨å±€çš„å‘å¸ƒ-è®¢é˜…å¯¹è±¡

```js
const Event = (function() {

  const clientList = {}

  const listen = function(key, fn) {
    if (!clientList[key]) {
      clientList[key] = []
    }
    clientList[key].push(fn)
  }

  const trigger = function(...args) {
    const key = args.shift()
    const fns = clientList[key]

    if (!fns || fns.length === 0) {
      return false
    }

    for (let i = 0, fn; fn = fns[i++];) {
      fn.apply(this, args)
    }
  }

  const remove = function(key, fn) {
    const fns = clientList[key]
    if (!fns) {
      return false
    }
    if (!fn) {
      fns && (fns.length = 0)
    } else {
      for (let i = fns.length - 1; i >= 0; i--) {
        const _fn = fns[i]
        if (_fn === fn) {
          fns.splice(i ,1)
        }
      }
    }
  }

  return {
    listen,
    trigger,
    remove
  }
})()

Event.listen('squareMeter88', fn1 = function(price) {
  console.log(`ä»·æ ¼= ${price}`)
})

Event.trigger('squareMeter88', 2000000)

Event.remove('squareMeter88', fn1)
```

#### å…ˆè®¢é˜…å†å‘å¸ƒ

æŸäº›åœºæ™¯ï¼Œæ¯”å¦‚QQç¦»çº¿æ¶ˆæ¯ï¼Œéœ€è¦å…ˆæŠŠæ¶ˆæ¯ä¿å­˜ä¸‹æ¥ï¼Œç­‰åˆ°æœ‰å¯¹è±¡è®¢é˜…äº†ï¼Œå†æŠŠæ¶ˆæ¯å‘å¸ƒç»™è®¢é˜…è€…ã€‚

#### å…¨å±€äº‹ä»¶å‘½åå†²çª

é¡¹ç›®ä½“ç§¯ä¸æ–­å¢å¤§ï¼Œéš¾å…å‡ºç°äº‹ä»¶åå†²çªã€‚éœ€è¦æä¾›åˆ›å»ºå‘½åç©ºé—´çš„åŠŸèƒ½ã€‚

### ç¬¬9ç«  å‘½ä»¤æ¨¡å¼

> Encapsulate a request as an object,thereby letting you parameterize clients with different requests,queue or log requests, and support undoable operations.ï¼ˆå°†ä¸€ä¸ªè¯·æ±‚å°è£…æˆä¸€ä¸ªå¯¹è±¡ï¼Œä»è€Œè®©ä½ ä½¿ç”¨ä¸åŒçš„è¯·æ±‚æŠŠå®¢æˆ·ç«¯å‚æ•°åŒ–ï¼Œå¯¹è¯·æ±‚æ’é˜Ÿæˆ–è€…è®°å½•è¯·æ±‚æ—¥å¿—ï¼Œå¯ä»¥æä¾›å‘½ä»¤çš„æ’¤é”€å’Œæ¢å¤åŠŸèƒ½ã€‚ï¼‰

è¿™é‡Œçœ‹ä¸€ä¸ªğŸŒ°

æœ‰ä¸€ä¸ªå¿«é¤åº—çš„ç‚¹é¤æœåŠ¡å‘˜ï¼Œå½“å®¢äººç‚¹é¤æˆ–è€…è®¢é¤æ—¶ï¼Œå°†éœ€æ±‚å†™åœ¨æ¸…å•ä¸Šäº¤ç»™å¨æˆ¿ï¼Œå®¢äººä¸ç”¨å…³å¿ƒæ˜¯å“ªä½å¨å¸ˆç»™ä»–åšèœã€‚å®¢äººè¿˜å¯ä»¥è¦æ±‚ä¸€å°æ—¶ä¹‹åå¼€å§‹ç‚’ä»–çš„èœï¼Œæ‰“ç”µè¯æ’¤å•ç­‰ç­‰ã€‚è¿™äº›è®°å½•ç€è®¢é¤ä¿¡æ¯çš„æ¸…å•å°±æ˜¯å‘½ä»¤æ¨¡å¼ä¸­çš„å‘½ä»¤å¯¹è±¡ã€‚

#### å‘½ä»¤æ¨¡å¼çš„ä¾‹å­---èœå•ç¨‹åº

ç»˜åˆ¶ä¸€æ’ButtonæŒ‰é’®ï¼Œç»™å…¶ç»‘å®š`click`äº‹ä»¶ã€‚

æŒ‰ä¸‹æŒ‰é’®ä¹‹åä¼šå‘ç”Ÿä¸€äº›äº‹æƒ…æ˜¯ä¸å˜çš„ï¼Œè€Œå…·ä½“å‘ç”Ÿä»€ä¹ˆäº‹æƒ…æ˜¯å¯å˜çš„ã€‚

`setCommand`å‡½æ•°è´Ÿè´£å¾€æŒ‰é’®ä¸Šå®‰è£…å‘½ä»¤ã€‚

```js
const setCommand = function(button, command) {
  botton.onclick = function() {
    command.excute()
  }
}

const MenuBar = {
  refresh() {
    console.log('åˆ·æ–°èœå•ç›®å½•')
  }
}

const SubMenu = {
  add() {
    console.log('å¢åŠ å­èœå•')
  },
  del() {
    console.log('åˆ é™¤å­èœå•')
  }
}

class RefreshMenuBarCommand {
  constructor(receiver) {
    this.receiver = receiver
  }

  excute() {
    this.receiver.refresh()
  }
}

class AddSubBarCommand {
  constructor(receiver) {
    this.receiver = receiver
  }

  excute() {
    this.receiver.add()
  }
}

const refreshMenuBarCommand = new RefreshMenuBarCommand(MenuBar)
const addSubMenuCommand = new AddSubMenuCommand(SubMenu)
const delSubMenuCommand = new DelSubMenuCommand(SubMenu)

setCommand(botton1, refreshMenuBarCommand)
setCommand(botton2, addSubMenuCommand)
setCommand(botton3, delSubMenuCommand)
```

#### JavaScriptä¸­çš„å‘½ä»¤æ¨¡å¼

```js
const RefreshMenuBarCommand = function(receiver) {
  return {
    execute() {
      receiver.refresh()
    }
  }
}

const setCommand = function(button, command) {
  botton.onclick = function() {
    command.excute()
  }
}

const refreshMenuBarCommand = RefreshMenuBarCommand(MenuBar)
setCommand(button1, refreshMenuBarCommand)
```

#### æ’¤é”€å‘½ä»¤

ç›´æ¥çœ‹ä»£ç ï¼Œåˆ©ç”¨å±æ€§å°†ä¹‹å‰æ“ä½œç»“æœè®°å½•ä¸‹æ¥

```js
class MoveCommand {
  constructor(receiver, pos) {
    this.receiver = receiver
    this.pos = pos
    this.oldPos = null
  }

  execute() {
    this.receiver.start('left', this.pos, 1000)
    this.oldPos = this.receiver.dom.getBoundingClientRect()[this.receiver.propertyName]
  }

  undo() {
    this.receiver.start('left', this.oldPos, 1000)
  }
}

moveBtn.onclick = function() {
  const animate = new animate(ball)
  moveCommand = new MoveCommand(animate, pos.value)
  moveCommand.execute()
}

cancelBtn.onclick = function() {
  moveCommand.undo()
}
```

#### å®å‘½ä»¤

```js
const MacroCommand = function() {
  return {
    commandList: [],
    add(command) {
      this.commandList.push(command)
    },
    execute() {
      for (let i = 0, command; command = this.commandList[i++];) {
        command.execute()
      }
    }
  }
}
```

### ç¬¬10ç«  ç»„åˆæ¨¡å¼(Composite Pattern)

"äº‹ç‰©æ˜¯ç”±ç›¸ä¼¼çš„å­äº‹ç‰©æ„æˆ"ã€‚

ç»„åˆæ¨¡å¼å°±æ˜¯ç”¨å°çš„å­å¯¹è±¡æ¥æ„å»ºæ›´å¤§çš„å¯¹è±¡ï¼Œè¿™äº›å°çš„å­å †åœ¨äº†æœ¬èº«ä¹Ÿè®¸æ˜¯ç”±æ›´å°çš„"å­™"å¯¹è±¡æ„æˆçš„ã€‚

å®å‘½ä»¤å¯¹è±¡åŒ…å«äº†ä¸€ç»„å…·ä½“çš„å­å‘½ä»¤å¯¹è±¡ï¼Œä¸ç®¡æ˜¯å®å‘½ä»¤å¯¹è±¡ï¼Œè¿˜æ˜¯å­å‘½ä»¤å¯¹è±¡ï¼Œéƒ½æœ‰ä¸€ä¸ª`excute`æ–¹æ³•è´Ÿè´£æ‰§è¡Œå‘½ä»¤ã€‚

å®å‘½ä»¤ä¸­åŒ…å«äº†ä¸€ç»„å­å‘½ä»¤ï¼Œä»–ä»¬ç»„æˆäº†ä¸€ä¸ªæ ‘å½¢ç»“æ„ã€‚

`MacroCommand`è¡¨ç°çš„åƒä¸€ä¸ªå‘½ä»¤ï¼Œå®é™…ä¸Šåªæ˜¯ä¸€ç»„çœŸæ­£å‘½ä»¤çš„â€œä»£ç†â€ï¼Œåªè´Ÿè´£ä¼ é€’è¯·æ±‚ç»™å¶å¯¹è±¡ã€‚

#### ç»„åˆæ¨¡å¼çš„ç”¨é€”

> Compose objects into tree structure to represent part-whole hierarchies.Composite lets clients treat individual objects and compositions of objects uniformly.

ç»„åˆæ¨¡å¼å°†å¯¹è±¡ç»„åˆæˆæ ‘å½¢ç»“æ„ï¼Œä½¿å¾—ç”¨æˆ·å¯¹å•ä¸ªå¯¹è±¡å’Œç»„åˆå¯¹è±¡çš„ä½¿ç”¨å…·æœ‰ä¸€è‡´æ€§ã€‚

æä¾›äº†ä¸€ç§éå†æ ‘å½¢ç»“æ„çš„æ–¹æ¡ˆï¼Œé€šè¿‡è°ƒç”¨ç»„åˆå¯¹è±¡çš„`excute`æ–¹æ³•ï¼Œç¨‹åºé€’å½’è°ƒç”¨ç»„åˆå¯¹è±¡ä¸‹é¢å¶å¯¹è±¡çš„`excute`æ–¹æ³•ã€‚

è¯·æ±‚ä»æ ‘æœ€é¡¶ç«¯çš„å¯¹è±¡å¾€ä¸‹ä¼ é€’ï¼Œå¦‚æœå­èŠ‚ç‚¹æ˜¯å¶å¯¹è±¡ï¼Œå¶å¯¹è±¡è‡ªèº«ä¼šå¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œå¦‚æœå­èŠ‚ç‚¹è¿˜æ˜¯ç»„åˆå¯¹è±¡ï¼Œè¯·æ±‚ä¼šç»§ç»­å‘ä¸‹ä¼ é€’ã€‚

![ç»„åˆæ¨¡å¼](./images/designpattern/tree.png)

é€æ˜æ€§çš„åŒæ—¶å¸¦æ¥å®‰å…¨é—®é¢˜ï¼Œè§£å†³æ–¹æ¡ˆé€šå¸¸æ˜¯ç»™å¶å¯¹è±¡å¢åŠ `add`æ–¹æ³•ï¼Œå¹¶ä¸”åœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶ï¼ŒæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸æ¥åŠæ—¶æé†’å®¢æˆ·ã€‚

```js
const openTvCommand = {
  excute() {
    console.log('æ‰“å¼€ç”µè§†')
  },
  add() {
    throw new Error('å¶å¯¹è±¡ä¸èƒ½æ·»åŠ å­èŠ‚ç‚¹')
  }
}
```

çœ‹ä¸€ä¸ªğŸŒ°---æ‰«ææ–‡ä»¶å¤¹

+ æ–‡ä»¶å¤¹ä¸­æ—¢å¯ä»¥åŒ…æ‹¬æ–‡ä»¶ï¼Œåˆå¯ä»¥åŒ…å«å…¶ä»–æ–‡ä»¶å¤¹ï¼Œç»„åˆæ¨¡å¼è®©ç²˜è´´å¤åˆ¶æˆäº†ä¸€ä¸ªç»Ÿä¸€çš„æ“ä½œã€‚
+ æ€æ¯’è½¯ä»¶æ‰«ææ–‡ä»¶å¤¹ï¼Œåªéœ€æ‰«ææœ€å¤–å±‚å³å¯ã€‚

```js
class Folder {
  constructor(name) {
    this.name = name
    this.parent = null
    this.files = []
  }
  add(file) {
    file.parent = this
    this.files.push(file)
  }
  scan() {
    console.log(`å¼€å§‹æ‰«ææ–‡ä»¶å¤¹${this.name}`)
    for (let i = 0, file; file = this.files[i++];) {
      file.scan()
    }
  }
  remove() {
    if (!this.parent) {
      return;
    }
    for (let files = this.parent.files, l = files.length - 1; l >= 0; l--) {
      let file = files[l]
      if (file === this) {
        files.splice(l, 1)
      }
    }
  }
}

class File {
  constructor(name) {
    this.name = name
    this.parent = null
  }
  add() {
    throw new Error('æ–‡ä»¶ä¸‹é¢ä¸èƒ½å†æ·»åŠ æ–‡ä»¶')
  }
  scan() {
    console.log(`å¼€å§‹æ‰«ææ–‡ä»¶${this.name}`)
  }
  remove() {
    if (!this.parent) {
      return;
    }
    for (let files = this.parent.files, l = files.length - 1; l >= 0; l--) {
      let file = files[l]
      if (file === this) {
        files.splice(l , 1)
      }
    }
  }
}

const folder = new Folder('Learning')

const folder1 = new Folder('CSS')
const folder2 = new Folder('JavaScript')

const file1 = new File('JavaScriptæƒå¨æŒ‡å—')
const file2 = new File('JavaScripté«˜çº§ç¨‹åºè®¾è®¡')
const file3 = new File('CSSæ­ç§˜')
const file4 = new File('Docker')

folder.add(folder1)
folder.add(folder2)
folder.add(file4)

folder1.add(file3)
folder2.add(file1)
folder2.add(file2)

folder.scan()
```

#### ä½•æ—¶ä½¿ç”¨ç»„åˆæ¨¡å¼

+ è¡¨ç¤ºå¯¹è±¡çš„éƒ¨åˆ†ï¼Œæ•´ä½“å±‚æ¬¡ç»“æ„ï¼Œåªéœ€è¦é€šè¿‡è¯·æ±‚æ ‘çš„æœ€é¡¶å±‚å¯¹è±¡ï¼Œä¾¿èƒ½å¯¹æ•´æ£µæ ‘åšç»Ÿä¸€çš„æ“ä½œã€‚
+ å®¢æˆ·å¸Œæœ›ç»Ÿä¸€å¯¹å¾…æ ‘ä¸­çš„æ‰€æœ‰å¯¹è±¡ï¼Œä¸ç”¨å…³å¿ƒå½“å‰æ­£åœ¨å¤„ç†çš„å¯¹è±¡æ˜¯ç»„åˆå¯¹è±¡è¿˜æ˜¯å¶å¯¹è±¡ã€‚ç»„åˆå¯¹è±¡å’Œå¶å¯¹è±¡ä¼šå„è‡ªåšè‡ªå·±æ­£ç¡®çš„äº‹æƒ…ï¼Œè¿™æ˜¯ç»„åˆæ¨¡å¼æœ€é‡è¦çš„èƒ½åŠ›ã€‚

### ç¬¬11ç«  æ¨¡æ¿æ–¹æ³•æ¨¡å¼(Template Method Pattern)

> DefineÂ theÂ skeletonÂ ofÂ anÂ algorithmÂ inÂ anÂ operation,deferringÂ someÂ stepsÂ toÂ subclasses.TemplateÂ MethodÂ letsÂ subclassÂ redefineÂ certainÂ stepsÂ ofÂ anÂ algorithmÂ withoutÂ changingÂ theÂ algorithm'sÂ structure.

æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯ä¸€ç§åªéœ€ä½¿ç”¨ç»§æ‰¿å°±å¯ä»¥å®ç°çš„æ¨¡å¼ã€‚

æ¨¡æ¿æ–¹æ³•æ¨¡å¼ç”±ä¸¤éƒ¨åˆ†ç»“æ„ç»„æˆï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯æŠ½è±¡çˆ¶ç±»ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯å…·ä½“çš„å®ç°å­ç±»ã€‚é€šå¸¸åœ¨æŠ½è±¡çˆ¶ç±»ä¸­å°è£…äº†å­ç±»çš„ç®—æ³•æ¡†æ¶ï¼ŒåŒ…æ‹¬å®ç°ä¸€äº›å…¬å…±æ–¹æ³•ä»¥åŠå°è£…å­ç±»ä¸­æ‰€æœ‰æ–¹æ³•çš„æ‰§è¡Œé¡ºåºã€‚å­ç±»é€šè¿‡ç»§æ‰¿è¿™ä¸ªæŠ½è±¡ç±»ï¼Œä¹Ÿç»§æ‰¿äº†æ•´ä¸ªç®—æ³•ç»“æ„ï¼Œå¹¶ä¸”å¯ä»¥é€‰æ‹©é‡å†™çˆ¶ç±»çš„æ–¹æ³•ã€‚

çœ‹ä¸€ä¸ªğŸŒ°---Coffee or Tea

æ³¡å’–å•¡çš„æ­¥éª¤é€šå¸¸å¦‚ä¸‹

1. æŠŠæ°´ç…®æ²¸
1. ç”¨æ²¸æ°´å†²æ³¡å’–å•¡
1. æŠŠå’–å•¡å€’è¿›æ¯å­
1. åŠ ç³–å’Œç‰›å¥¶

æ³¡èŒ¶çš„æ­¥éª¤é€šå¸¸å¦‚ä¸‹

1. æŠŠæ°´ç…®æ²¸
1. ç”¨æ²¸æ°´æµ¸æ³¡èŒ¶å¶
1. å§èŒ¶æ°´å€’è¿›æ¯å­
1. åŠ æŸ æª¬

åˆ†ç¦»å‡ºå…±åŒç‚¹

+ åŸæ–™ä¸åŒ --- æŠ½è±¡ä¸ºâ€œé¥®æ–™â€
+ æ³¡çš„æ–¹å¼ä¸åŒ --- æŠ½è±¡ä¸ºâ€œæ³¡â€
+ åŠ å…¥çš„è°ƒæ–™ä¸åŒ --- æŠ½è±¡ä¸ºâ€œè°ƒæ–™â€

æ•´ç†ä¸ºä¸‹é¢å››ä¸ªæ­¥éª¤

1. æŠŠæ°´ç…®æ²¸
1. ç”¨æ²¸æ°´å†²æ³¡é¥®æ–™
1. æŠŠé¥®æ–™å€’å…¥æ¯å­
1. åŠ è°ƒæ–™

```js
class Beverage {
  boilWater() {
    console.log('æŠŠæ°´ç…®æ²¸')
  }
  brew() {}
  pourInCup() {}
  addCondiments() {}
  init() {
    this.boilWater()
    this.brew()
    this.pourInCup()
    this.addCondiments()
  }
}

class Coffee extends Beverage {
  brew() {
    console.log('ç”¨æ²¸æ°´å†²æ³¡å’–å•¡')
  }
  pourInCup() {
    console.log('æŠŠå’–å•¡å€’è¿›æ¯å­')
  }
  addCondiments() {
    console.log('åŠ ç³–å’Œç‰›å¥¶')
  }
}

class Tea extends Beverage {
  brew() {
    console.log('ç”¨æ²¸æ°´æµ¸æ³¡èŒ¶å¶')
  }
  pourInCup() {
    console.log('æŠŠèŒ¶å€’è¿›æ¯å­')
  }
  addCondiments() {
    console.log('åŠ æŸ æª¬')
  }
}

const coffee = new Coffee()
const tea = new Tea()
coffee.init()
tea.init()
```

`Beverage`ç±»çš„`init`æ–¹æ³•å°±æ˜¯æ¨¡æ¿æ–¹æ³•ï¼Œä»–å…¶ä¸­å°è£…äº†å­ç±»çš„ç®—æ³•æ¡†æ¶ã€‚

#### æŠ½è±¡ç±»

åœ¨Javaä¸­ï¼Œæœ‰ä¸¤ç§ç±»ï¼ŒæŠ½è±¡ç±»å’Œå…·ä½“ç±»ï¼Œå…·ä½“ç±»å¯ä»¥è¢«å®ä¾‹åŒ–ï¼ŒæŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ã€‚æŠ½è±¡ç±»ç”¨æ¥è¢«æŸäº›å…·ä½“ç±»ç»§æ‰¿ã€‚

æŠ½è±¡æ–¹æ³•è¢«å£°æ˜åœ¨æŠ½è±¡ç±»ä¸­ï¼ŒæŠ½è±¡æ–¹æ³•æ²¡æœ‰å…·ä½“çš„å®ç°è¿‡ç¨‹ï¼Œå­ç±»ç»§æ‰¿æŠ½è±¡ç±»æ—¶ï¼Œå¿…é¡»é‡å†™çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•ã€‚

Javaä¸­çš„æ–¹æ³•

```java
public abstract class Beverage {
    final void init() {
        boilWater();
        brew();
        pourInCup();
        addCondiments();
    }

    void boilWater() {
        System.out.println("æŠŠæ°´ç…®æ²¸");
    }

    abstract void brew();
    abstract void addCondiments();
    abstract void pourInCup();
}

public class Coffee extends Beverage {
    @Override
    void brew() {
        System.out.println("ç”¨æ²¸æ°´å†²æ³¡å’–å•¡");
    }

    @Override
    void pourInCup() {
        System.out.println("æŠŠå’–å•¡å€’è¿›æ¯å­");
    }

    @Override
    void addCondiments() {
        System.out.println("åŠ ç³–å’Œç‰›å¥¶");
    }
}

public class Tea extends Beverage {
    @Override
    void brew() {
        System.out.println("ç”¨æ²¸æ°´æµ¸æ³¡èŒ¶å¶");
    }

    @Override
    void pourInCup() {
        System.out.println("æŠŠèŒ¶å€’è¿›æ¯å­");
    }

    @Override
    void addCondiments() {
        System.out.println("åŠ æŸ æª¬");
    }
}

public class Test {
    private static void prepareRecipe( Beverage beverage ) {
        beverage.init();
    }

    public static void main( String args[] ) {
        Beverage coffee = new Coffee();
        prepareRecipe(coffee);

        Beverage tea = new Tea();
        prepareRecipe(tea);
    }
}
```

åœ¨Javaä¸­ä¼šä¿è¯å­ç±»å¿…é¡»é‡å†™çˆ¶ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œä½†æ˜¯åœ¨JavaScriptä¸­æ²¡æœ‰æ£€æŸ¥ï¼Œæœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆã€‚

1. ç”¨é¸­å­ç±»å‹æ¥æ£€æŸ¥æ¥å£
1. è®©Bevearge.prototype.brewç­‰æ–¹æ³•ç›´æ¥æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸

#### é’©å­æ–¹æ³•

```js
class Beverage {
  boilWater() {
    console.log('æŠŠæ°´ç…®æ²¸')
  }
  brew() {
    throw new Error('å­ç±»å¿…é¡»é‡å†™brewæ–¹æ³•')
  }
  pourInCup() {
    throw new Error('å­ç±»å¿…é¡»é‡å†™pourInCupæ–¹æ³•')
  }
  addCondiments() {
    throw new Error('å­ç±»å¿…é¡»é‡å†™addCondimentsæ–¹æ³•')
  }
  customerWantsConfiments() {
    return true;
  }
  init() {
    this.boilWater()
    this.brew()
    this.pourInCup()
    if (this.customerWantsConfiments()) {
      this.addCondiments()
    }
  }
}
```

#### å°ç»“

æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯ä¸€ç§å…¸å‹çš„é€šè¿‡å°è£…å˜åŒ–æé«˜ç³»ç»Ÿæ‰©å±•æ€§çš„è®¾è®¡æ¨¡å¼

### ç¬¬12ç«  äº«å…ƒæ¨¡å¼(Flyweight Pattern)

> Use sharing to support large numbers of fine-grained objects efficiently.ï¼ˆä½¿ç”¨å…±äº«å¯¹è±¡å¯æœ‰æ•ˆåœ°æ”¯æŒå¤§é‡çš„ç»†ç²’åº¦å¯¹è±¡ã€‚ï¼‰

ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæ²¡æœ‰å¿…è¦ä¸ºæ¯ä¸€é¦–æ­Œæ›²éƒ½åˆ›å»ºä¸€ä¸ªæ’­æ”¾å¯¹è±¡ï¼Œåªç”¨ä¸€ä¸ªæ’­æ”¾å¯¹è±¡ï¼Œé€šè¿‡åˆ‡æ¢urlï¼Œæ’­æ”¾æ—¶é—´ç­‰å‚æ•°æ¥æ§åˆ¶æ­Œæ›²çš„æ’­æ”¾ã€‚

äº«å…ƒæ¨¡å¼è¦æ±‚å°†å¯¹è±¡çš„å±æ€§åˆ’åˆ†ä¸ºå†…éƒ¨çŠ¶æ€å’Œå¤–éƒ¨çŠ¶æ€ã€‚äº«å…ƒæ¨¡å¼çš„ç›®æ ‡æ˜¯å°½é‡å‡å°‘å…±äº«å¯¹è±¡çš„æ•°é‡ã€‚

+ å†…éƒ¨çŠ¶æ€å­˜å‚¨äºå¯¹è±¡å†…éƒ¨
+ å†…éƒ¨çŠ¶æ€å¯ä»¥è¢«ä¸€äº›å¯¹è±¡å…±äº«
+ å†…éƒ¨çŠ¶æ€ç‹¬ç«‹äºå…·ä½“çš„åœºæ™¯ï¼Œé€šå¸¸ä¸ä¼šæ”¹å˜
+ å¤–éƒ¨çŠ¶æ€å–å†³äºå…·ä½“çš„åœºæ™¯ï¼Œå¹¶æ ¹æ®åœºæ™¯è€Œå˜åŒ–ï¼Œå¤–éƒ¨çŠ¶æ€ä¸èƒ½è¢«å…±äº«

äº«å…ƒæ¨¡å¼æ˜¯ä¸€ç§ç”¨æ—¶é—´æ¢ç©ºé—´çš„æ€§èƒ½ä¼˜åŒ–æ¨¡å¼ã€‚

#### æ–‡ä»¶ä¸Šä¼ çš„ä¾‹å­

```js
class Upload {
  constructor(uploadType) {
    this.uploadType = uploadType;
  }

  delFile(id) {
    uploadManager.setExternalState(id, this); // (1)
    if (this.fileSize < 3000) {
      return this.dom.parentNode.removeChild(this.dom);
    }
    if (window.confirm('ç¡®å®šè¦åˆ é™¤è¯¥æ–‡ä»¶å—? ' + this.fileName)) {
      return this.dom.parentNode.removeChild(this.dom);
    }
  }
}

const UploadFactory = (function () {
  const createdFlyWeightObjs = {};
  return {
    create: function (uploadType) {
      if (createdFlyWeightObjs[uploadType]) {
        return createdFlyWeightObjs[uploadType];
      }
      return createdFlyWeightObjs[uploadType] = new Upload(uploadType);
    }
  }
})();

const uploadManager = (function () {
  const uploadDatabase = {};
  return {
    add: function (id, uploadType, fileName, fileSize) {
      const flyWeightObj = UploadFactory.create(uploadType);
      const dom = document.createElement('div');
      dom.innerHTML = '<span>æ–‡ä»¶åç§°:' + fileName + ', æ–‡ä»¶å¤§å°: ' + fileSize + '</span>' + '<button class="delFile">åˆ é™¤</button>';
      dom.querySelector('.delFile').onclick = function () {
        flyWeightObj.delFile(id);
      }
      document.body.appendChild(dom);
      uploadDatabase[id] = {
        fileName: fileName,
        fileSize: fileSize,
        dom: dom
      };
      return flyWeightObj;
    },
    setExternalState: function (id, flyWeightObj) {
      const uploadData = uploadDatabase[id];
      for (const i in uploadData) {
        flyWeightObj[i] = uploadData[i];
      }
    }
  }
})();
```

äº«å…ƒæ¨¡å¼æ˜¯ä¸€ç§å¾ˆå¥½çš„æ€§èƒ½ä¼˜åŒ–æ–¹æ¡ˆï¼Œä½†æ˜¯éœ€è¦å¤šç»´æŠ¤ä¸€ä¸ª`factory`å¯¹è±¡å’Œä¸€ä¸ª`manager`å¯¹è±¡ã€‚

ä»¥ä¸‹æƒ…å†µå¯ä»¥ä½¿ç”¨äº«å…ƒæ¨¡å¼ï¼š

+ ä¸€ä¸ªç¨‹åºä¸­ä½¿ç”¨äº†å¤§é‡çš„ç›¸ä¼¼å¯¹è±¡
+ ä½¿ç”¨äº†å¤§é‡å¯¹è±¡ï¼Œé€ æˆå¾ˆå¤§çš„å†…å­˜å¼€é”€
+ å¯¹è±¡çš„å¤§å¤šæ•°çŠ¶æ€éƒ½å¯ä»¥å˜ä¸ºå¤–éƒ¨çŠ¶æ€
+ å‰¥ç¦»å‡ºå¯¹è±¡çš„å¤–éƒ¨çŠ¶æ€ä¹‹åï¼Œå¯ä»¥ç”¨ç›¸å¯¹è¾ƒå°‘çš„å…±äº«å¯¹è±¡å–ä»£å¤§é‡å¯¹è±¡

#### å¯¹è±¡æ± 

åŸç†ï¼šäººæ‰‹ä¸€æœ¬æƒå¨æŒ‡å—å¤ªæµªè´¹ï¼Œå…ˆä¹°ä¸€æœ¬æ”¾å…¬å…±ä¹¦æ¶ä¸Šï¼Œçœ‹çš„æ—¶å€™å»å€Ÿï¼Œå€Ÿå®Œäº†æ”¾å›å»ï¼Œå¦‚æœåŒæ—¶æœ‰ä¸¤ä¸ªäººè¦çœ‹ï¼Œå°±å†å»ä¹°ä¸€æœ¬...

çœ‹ä¸€ä¸ªç®€å•çš„åº”ç”¨

åœ°å›¾åº”ç”¨ä¸Šçš„å°æ°”æ³¡ï¼Œæœç´¢Açš„æ—¶å€™å‡ºæ¥ä¸¤ä¸ªï¼Œæœç´¢Bå‡ºæ¥6ä¸ªï¼Œåœ¨ç¬¬äºŒæ¬¡çš„æœç´¢ä¸­åªéœ€è¦å†åˆ›å»ºå››ä¸ªå³å¯ã€‚

ä¸€ä¸ªé€šç”¨çš„å¯¹è±¡æ± å®ç°

```js
const objectPoolFactory = function(createObjFn) {
  const objectPool = []

  return {
    create(...args) {
      const obj = objectPool.length === 0 ? createObjFn.apply(this, args) : objectPool.shift()

      return obj;
    },
    recover(obj) {
      objectPool.push(obj)
    }
  }
}

const testObjFactory = objectPoolFactory(() => {
  // å¯¹è±¡çš„è¡Œä¸º
  const testObj = {}

  return testObj;
})
```

å¯ä»¥åœ¨åˆ›å»ºçš„æ—¶å€™ç»™åŠ å…¥åˆ°ä¸€ä¸ªæ•°ç»„ä¸­ä¿å­˜ï¼Œç”¨å®Œä¹‹åå¯¹æ•°ç»„ä¸­å…ƒç´ è¿›è¡Œrecover(å›æ”¶)æ“ä½œã€‚

#### å°ç»“

äº«å…ƒæ¨¡å¼åœ¨ä¸€ä¸ªå­˜åœ¨å¤§é‡ç›¸ä¼¼å¯¹è±¡çš„ç³»ç»Ÿä¸­å¯ä»¥å¾ˆå¥½çš„è§£å†³å¤§é‡å¯¹è±¡å¸¦æ¥çš„æ€§èƒ½é—®é¢˜ã€‚

### ç¬¬13ç«  èŒè´£é“¾æ¨¡å¼

> Avoid coupling the sender of a request to its receiver by giving more than one object a chance to handle the request.Chain the receiving objects and pass the request along the chain until an object handles it.ï¼ˆä½¿å¤šä¸ªå¯¹è±¡æœ‰æœºä¼šå¤„ç†è¯·æ±‚ï¼Œä»è€Œé¿å…äº†è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆå…³ç³» ã€‚å°†è¿™äº›å¯¹è±¡è¿æˆä¸€ä¸ªé“¾ï¼Œå¹¶æ²¿ç€è¿™æ¡é“¾ä¼ é€’è¯·æ±‚ï¼ŒçŸ¥é“æœ‰å¯¹è±¡å¤„ç†å®ƒä¸ºæ­¢ã€‚ï¼‰

çœ‹ğŸŒ°

åå…¬äº¤ï¼Œäººå¤ªå¤šï¼Œåé—¨ä¸Šè½¦ï¼ŒæŠ•å¸ï¼Œä¸€ä¸ªæ¥ä¸€ä¸ªä¼ è¿‡å»ã€‚

å¼±åŒ–äº†å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„å¼ºè”ç³»ã€‚

çœ‹éœ€æ±‚

å…¬å¸é’ˆå¯¹æ”¯ä»˜è¿‡å®šé‡‘çš„ç”¨æˆ·æœ‰ä¸€å®šçš„ä¼˜æƒ æ”¿ç­–ã€‚åœ¨æ­£å¼è´­ä¹°åï¼Œå·²ç»æ”¯ä»˜è¿‡ 500 å…ƒå®šé‡‘çš„ç”¨ æˆ·ä¼šæ”¶åˆ° 100 å…ƒçš„å•†åŸä¼˜æƒ åˆ¸ï¼Œ200 å…ƒå®šé‡‘çš„ç”¨æˆ·å¯ä»¥æ”¶åˆ° 50 å…ƒçš„ä¼˜æƒ åˆ¸ï¼Œè€Œä¹‹å‰æ²¡æœ‰æ”¯ä»˜å®šé‡‘ çš„ç”¨æˆ·åªèƒ½è¿›å…¥æ™®é€šè´­ä¹°æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰ä¼˜æƒ åˆ¸ï¼Œä¸”åœ¨åº“å­˜æœ‰é™çš„æƒ…å†µä¸‹ä¸ä¸€å®šä¿è¯èƒ½ä¹°åˆ°ã€‚
æˆ‘ä»¬çš„è®¢å•é¡µé¢æ˜¯ PHP åå‡ºçš„æ¨¡æ¿ï¼Œåœ¨é¡µé¢åŠ è½½ä¹‹åˆï¼ŒPHP ä¼šä¼ é€’ç»™é¡µé¢å‡ ä¸ªå­—æ®µã€‚

+ orderType:è¡¨ç¤ºè®¢å•ç±»å‹(å®šé‡‘ç”¨æˆ·æˆ–è€…æ™®é€šè´­ä¹°ç”¨æˆ·)ï¼Œcode çš„å€¼ä¸º 1 çš„æ—¶å€™æ˜¯ 500 å…ƒ å®šé‡‘ç”¨æˆ·ï¼Œä¸º 2 çš„æ—¶å€™æ˜¯ 200 å…ƒå®šé‡‘ç”¨æˆ·ï¼Œä¸º 3 çš„æ—¶å€™æ˜¯æ™®é€šè´­ä¹°ç”¨æˆ·ã€‚
+ pay:è¡¨ç¤ºç”¨æˆ·æ˜¯å¦å·²ç»æ”¯ä»˜å®šé‡‘ï¼Œå€¼ä¸º true æˆ–è€… false, è™½ç„¶ç”¨æˆ·å·²ç»ä¸‹è¿‡ 500 å…ƒå®šé‡‘çš„ è®¢å•ï¼Œä½†å¦‚æœä»–ä¸€ç›´æ²¡æœ‰æ”¯ä»˜å®šé‡‘ï¼Œç°åœ¨åªèƒ½é™çº§è¿›å…¥æ™®é€šè´­ä¹°æ¨¡å¼ã€‚
+ stock:è¡¨ç¤ºå½“å‰ç”¨äºæ™®é€šè´­ä¹°çš„æ‰‹æœºåº“å­˜æ•°é‡ï¼Œå·²ç»æ”¯ä»˜è¿‡ 500 å…ƒæˆ–è€… 200 å…ƒå®šé‡‘çš„ç”¨ æˆ·ä¸å—æ­¤é™åˆ¶ã€‚

```js
var order = function (orderType, pay, stock) {
  if (orderType === 1) { // 500 å…ƒå®šé‡‘è´­ä¹°æ¨¡å¼
    if (pay === true) { // å·²æ”¯ä»˜å®šé‡‘
      console.log('500 å…ƒå®šé‡‘é¢„è´­, å¾—åˆ° 100 ä¼˜æƒ åˆ¸');
    } else { // æœªæ”¯ä»˜å®šé‡‘ï¼Œé™çº§åˆ°æ™®é€šè´­ä¹°æ¨¡å¼
      if (stock > 0) { // ç”¨äºæ™®é€šè´­ä¹°çš„æ‰‹æœºè¿˜æœ‰åº“å­˜
        console.log('æ™®é€šè´­ä¹°, æ— ä¼˜æƒ åˆ¸');
      } else {
        console.log('æ‰‹æœºåº“å­˜ä¸è¶³');
      }
    }
  } else if (orderType === 2) {
    if (pay === true) {
      // 200 å…ƒå®šé‡‘è´­ä¹°æ¨¡å¼
      console.log('200 å…ƒå®šé‡‘é¢„è´­, å¾—åˆ° 50 ä¼˜æƒ åˆ¸');
    } else {
      if (stock > 0) {
        console.log('æ™®é€šè´­ä¹°, æ— ä¼˜æƒ åˆ¸');
      } else {
        console.log('æ‰‹æœºåº“å­˜ä¸è¶³');
      }
    }
  } else if (orderType === 3) {
    if (stock > 0) {
      console.log('æ™®é€šè´­ä¹°, æ— ä¼˜æƒ åˆ¸');
    } else {
      console.log('æ‰‹æœºåº“å­˜ä¸è¶³');
    }
  }
}

order(1, true, 500); // è¾“å‡º: 500 å…ƒå®šé‡‘é¢„è´­, å¾—åˆ° 100 ä¼˜æƒ åˆ¸
```

### ç¬¬14ç«  ä¸­ä»‹è€…æ¨¡å¼(Mediator Pattern)

> DefineÂ anÂ objectÂ thatÂ encapsulatesÂ howÂ aÂ setÂ ofÂ objectsÂ interact.MediatorÂ promotesÂ looseÂ coupingÂ byÂ keepingÂ objectsÂ fromÂ referringÂ toÂ eachÂ otherÂ explicitly,andÂ itÂ letsÂ youÂ varyÂ theirÂ interactionÂ independently.ï¼ˆç”¨ä¸€ä¸ªä¸­ä»‹å¯¹è±¡å°è£…ä¸€ç³»åˆ—çš„å¯¹è±¡äº¤äº’ï¼Œä¸­ä»‹è€…ä½¿å„å¯¹è±¡ä¸éœ€è¦æ˜¾ç¤ºçš„ç›¸äº’ä½œç”¨ï¼Œä»è€Œä½¿å…¶è€¦åˆæ¾æ•£ï¼Œè€Œä¸”å¯ä»¥ç‹¬ç«‹çš„æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚ï¼‰

ä¸­ä»‹è€…æ¨¡å¼çš„ä½œç”¨å°±æ˜¯è§£é™¤å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„ç´§è€¦åˆå…³ç³»ã€‚å¢åŠ ä¸€ä¸ªä¸­ä»‹è€…å¯¹è±¡åï¼Œæ‰€æœ‰çš„ç›¸å…³å¯¹è±¡éƒ½é€šè¿‡ä¸­ä»‹è€…å¯¹è±¡æ¥é€šä¿¡ï¼Œè€Œä¸æ˜¯ç›¸äº’å¼•ç”¨ã€‚ä¸­ä»‹è€…ä½¿å„å¯¹è±¡ä¹‹é—´è€¦åˆæ¾æ•£ï¼Œè€Œä¸”å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜å®ƒä»¬ä¹‹é—´çš„äº¤äº’ã€‚ä¸­ä»‹è€…æ¨¡å¼ä½¿ç½‘çŠ¶çš„å¤šå¯¹å¤šå…³ç³»å˜æˆäº†ç›¸å¯¹ç®€å•çš„ä¸€å¯¹å¤šå…³ç³»ã€‚

#### ç°å®ä¸­çš„ä¸­ä»‹è€…

å¦‚æœæ²¡æœ‰æœºåœºæŒ‡æŒ¥å¡”çš„å­˜åœ¨ï¼Œæ¯ä¸€æ¶é£æœºè¦å’Œæ–¹åœ†100kmé‡Œçš„æ‰€æœ‰é£æœºé€šä¿¡ï¼Œæ‰èƒ½ç¡®å®šèˆªçº¿ä»¥åŠé£è¡ŒçŠ¶å†µã€‚æŒ‡æŒ¥å¡”ä½œä¸ºè°ƒåœè€…ï¼ŒçŸ¥é“æ¯ä¸€æ¶é£æœºçš„é£è¡ŒçŠ¶å†µï¼Œå¯ä»¥å®‰æ’æ‰€æœ‰é£æœºçš„èµ·é™æ—¶é—´ï¼ŒåŠæ—¶ä½œå‡ºèˆªçº¿è°ƒæ•´ã€‚

#### æ‹¿æ³¡æ³¡å ‚ä¸¾ä¸ªä¾‹å­

```js
const players = []

class Player {
  constructor(name, teamColor) {
    this.partners = []
    this.enemies = []
    this.state = 'alive'
    this.name = name
    this.teamColor = teamColor
  }

  win() {
    console.log(`winner: ${this.name}`)
  }

  lose() {
    console.log(`loser: ${this.name}`)
  }

  die() {
    this.state = 'dead'
    let all_dead = this.partners.every(i => {
      return i.state === 'dead'
    })

    if (all_dead) {
      this.lose()
      this.partners.forEach(i => i.lose())
      this.enemies.forEach(i => i.win())
    }
  }
}

// åˆ›å»ºç©å®¶çš„å·¥å‚
const playerFactory = function(name, teamColor) {
  const newPlayer = new Player(name, teamColor)

  players.forEach(i => {
    if (i.teamColor === newPlayer.teamColor) {
      i.partners.push(newPlayer)
      newPlayer.partners.push(i)
    } else {
      i.enemies.push(newPlayer)
      newPlayer.enemies.push(i)
    }
  })

  players.push(newPlayer)

  return newPlayer
}

const player1 = playerFactory('çš®è›‹', 'red'),
      player2 = playerFactory('å°ä¹–', 'red'),
      player3 = playerFactory('å®å®', 'red'),
      player4 = playerFactory('å°å¼º', 'red')

const player5 = playerFactory('é»‘å¦', 'blue'),
      player6 = playerFactory('è‘±å¤´', 'blue'),
      player7 = playerFactory('èƒ–å¢©', 'blue'),
      player8 = playerFactory('æµ·ç›—', 'blue')

player1.die()
player2.die()
player3.die()
player4.die()

// loser: çš®è›‹
// loser: å°ä¹–
// loser: å®å®
// winner: é»‘å¦
// winner: è‘±å¤´
// winner: èƒ–å¢©
// winner: æµ·ç›—
```

æ¯ä¸ªç©å®¶å’Œå…¶ä»–ç©å®¶éƒ½æ˜¯ç´§å¯†è€¦åˆåœ¨ä¸€èµ·çš„ï¼Œæ¯ä¸ªç©å®¶å¯¹è±¡å±æ€§ä¸­éƒ½æœ‰`partners`å’Œ`enemies`ç”¨æ¥ä¿å‡†å…¶ä»–ç©å®¶å¯¹è±¡çš„å¼•ç”¨ï¼Œæ¯ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘ç”Ÿæ”¹å˜ï¼Œéƒ½è¦æ˜¾å¼éå†é€šçŸ¥å…¶ä»–å¯¹è±¡ã€‚

#### ä½¿ç”¨ä¸­ä»‹è€…æ¨¡å¼æ”¹é€ 

```js
class Player {
  constructor(name, teamColor) {
    this.name = name
    this.teamColor = teamColor
    this.state = 'alive'
  }

  win() {
    console.log(`${this.name} won`)
  }

  lose() {
    console.log(`${this.name} lost`)
  }

  die() {
    this.state = 'dead'
    playerDirector.receiveMessage('playerDead', this)
  }

  remove() {
    playerDirector.receiveMessage('removePlayer', this)
  }

  changeTeam() {
    playerDirector.receiveMessage('addPlayer', this, color)
  }
}

const playerFactory = function(name, teamColor) {
  const newPlayer = new Player(name, teamColor)
  playerDirector.receiveMessage('addPlayer', newPlayer)

  return newPlayer
}

const playerDirector = new class{
  constructor() {
    this.players = {}
  }
  // æ–°å¢ä¸€ä¸ªç©å®¶
  addPlayer(player) {
    const { teamColor } = player
    this.players[teamColor] = this.players[teamColor] || []
    this.players[teamColor].push(player)
  }
  // ç§»é™¤ä¸€ä¸ªç©å®¶
  removePlayer(player) {
    const { teamColor } = player
    const { [teamColor]: teamPlayers = [] } = this.players

    let index = teamPlayers.findIndex(i => i === player)
    ~index && teamPlayers.splice(index, 1)
  }
  // ç©å®¶æ¢é˜Ÿä¼
  changeTeam(player, newTeamColor) {
    this.removePlayer(player)
    player.teamColor = newTeamColor
    this.addPlayer(player)
  }
  // ç©å®¶æ­»äº¡
  playerDead(player) {
    const { teamColor } = player
    const { [teamColor]: teamPlayers } = this.players

    let all_dead = teamPlayers.every(i => {
      return i.state === 'dead'
    })

    if (all_dead) {
      teamPlayers.forEach(i => {
        i.lose()
      })

      for (let [color, team] of Object.entries(this.players)) {
        if (color !== teamColor) {
          team.forEach(player => {
            player.win()
          })
        }
      }
    }
  }
  receiveMessage(operation, ...args) {
    this[operation].apply(this, args)
  }
}()

const player1 = playerFactory('çš®è›‹', 'red'),
      player2 = playerFactory('å°ä¹–', 'red'),
      player3 = playerFactory('å®å®', 'red'),
      player4 = playerFactory('å°å¼º', 'red')

const player5 = playerFactory('é»‘å¦', 'blue'),
      player6 = playerFactory('è‘±å¤´', 'blue'),
      player7 = playerFactory('èƒ–å¢©', 'blue'),
      player8 = playerFactory('æµ·ç›—', 'blue')

player1.die()
player2.die()
player3.die()
player4.die()

// çš®è›‹ lost
// å°ä¹– lost
// å®å® lost
// å°å¼º lost
// é»‘å¦ won
// è‘±å¤´ won
// èƒ–å¢© won
// æµ·ç›— won
```

#### å°ç»“

ä¸­ä»‹è€…æ¨¡å¼ä½¿å¾—å„ä¸ªå¯¹è±¡ä¹‹é—´å¾—ä»¥è§£è€¦ï¼Œæ¯ä¸ªå¯¹è±¡åªéœ€å…³æ³¨è‡ªèº«åŠŸèƒ½çš„å®ç°ï¼Œå¯¹è±¡ä¹‹é—´çš„äº¤äº’å…³ç³»äº¤ç»™äº†ä¸­ä»‹è€…å¯¹è±¡æ¥å®ç°å’Œç»´æŠ¤

### ç¬¬15ç«  è£…é¥°è€…æ¨¡å¼(Decorator Pattern)

> Attach additional responsibilities to an object dynamically keeping the same interface.Decorators provide a flexible alternative to subclassing for extending functionality.ï¼ˆåŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ã€‚å°±å¢åŠ åŠŸèƒ½æ¥è¯´ï¼Œè£…é¥°æ¨¡å¼ç›¸æ¯”ç”Ÿæˆå­ç±»æ›´ä¸ºçµæ´»ã€‚ï¼‰

è£…é¥°è€…æ¨¡å¼å¯ä»¥åŠ¨æ€åœ°ç»™æŸä¸ªå¯¹è±¡æ·»åŠ ä¸€äº›é¢å¤–çš„èŒè´£ï¼Œè€Œä¸ä¼šå½±å“ä»è¿™ä¸ªç±»ä¸­æ´¾ç”Ÿçš„å…¶ä»–å¯¹è±¡ã€‚

è£…é¥°ç€æ¨¡å¼ä¹Ÿç§°ä¸ºåŒ…è£…å™¨(wrapper)æ¨¡å¼ã€‚å®é™…ä¸Šå°†ä¸€ä¸ªå¯¹è±¡åµŒå…¥å¦ä¸€ä¸ªå¯¹è±¡ä¹‹ä¸­ï¼Œå½¢æˆä¸€æ¡åŒ…è£…é“¾ï¼Œè¯·æ±‚éšç€è¿™æ¡é“¾ä¾æ¬¡ä¼ é€’åˆ°æ‰€æœ‰çš„å¯¹è±¡ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰å¤„ç†è¯·æ±‚çš„æœºä¼šã€‚

#### ä½¿ç”¨AOPè£…é¥°å‡½æ•°

```js
Function.prototype.before = function(beforefn) {
  const _this = this;

  return (...args) => {
    beforefn.apply(this, args);

    return _this.apply(this, args);
  }
}

Function.prototype.after = function(afterfn) {
  const _this = this;

  return (...args) => {
    const ret = _this.apply(this, args);
    afterfn.apply(this, args);

    return ret;
  }
}
```

### ç¬¬16ç«  çŠ¶æ€æ¨¡å¼

> Allow an object to alter its behavior when its internal state changes.The object will appear to change its class.ï¼ˆå½“ä¸€ä¸ªå¯¹è±¡åœ¨çŠ¶æ€æ”¹å˜æ—¶å…è®¸å…¶æ”¹å˜è¡Œä¸ºï¼Œè¿™ä¸ªå¯¹è±¡çœ‹èµ·æ¥åƒæ”¹å˜äº†å…¶ç±»ã€‚ï¼‰

çŠ¶æ€æ¨¡å¼çš„å…³é”®æ˜¯åŒºåˆ†äº‹ç‰©å†…éƒ¨çš„çŠ¶æ€ï¼Œäº‹ç‰©å†…éƒ¨çŠ¶æ€çš„æ”¹å˜å¾€å¾€ä¼šå¸¦æ¥äº‹ç‰©çš„è¡Œä¸ºæ”¹å˜ã€‚

çŠ¶æ€æ¨¡å¼çš„å…³é”®æ˜¯æŠŠäº‹ç‰©çš„æ¯ç§çŠ¶æ€éƒ½å°è£…æˆå•ç‹¬çš„ç±»ï¼Œè·Ÿæ­¤ç§çŠ¶æ€æœ‰å…³çš„è¡Œä¸ºéƒ½è¢«å°è£…åœ¨è¿™ä¸ªç±»çš„å†…éƒ¨ï¼Œå°†è¯·æ±‚å§”æ‰˜ç»™å½“å‰çš„çŠ¶æ€å¯¹è±¡ï¼Œè¯¥çŠ¶æ€å¯¹è±¡ä¼šè´Ÿè´£æ¸²æŸ“è‡ªèº«çš„è¡Œä¸ºã€‚

### ç¬¬17ç«  é€‚é…å™¨æ¨¡å¼

> é€‚é…å™¨æ¨¡å¼çš„ä½œç”¨æ˜¯è§£å†³ä¸¤ä¸ªè½¯ä»¶å®ä½“é—´çš„æ¥å£ä¸å…¼å®¹çš„é—®é¢˜ã€‚ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ä¹‹åï¼ŒåŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½å·¥ä½œçš„ä¸¤ä¸ªè½¯ä»¶å®ä½“å¯ä»¥ä¸€èµ·å·¥ä½œã€‚

### å·¥å‚æ¨¡å¼(Factory Pattern)

> DefineÂ anÂ interfaceÂ forÂ creatingÂ anÂ object,butÂ letÂ subclassÂ decideÂ whichÂ classÂ toÂ instantiate.FactoryÂ MethodÂ letsÂ aÂ classÂ deferÂ instantiationÂ toÂ subclass.ï¼ˆå®šä¹‰ä¸€ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„æ¥å£ï¼Œè®©å­ç±»å†³å®šå®ä¾‹åŒ–å“ªä¸€ä¸ªç±»ã€‚å·¥å‚æ–¹æ³•æ˜¯ä¸€ä¸ªç±»çš„å®ä¾‹åŒ–å»¶è¿Ÿåˆ°å…¶å­ç±»ã€‚ï¼‰

åœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™ä¸ä¼šå¯¹å®¢æˆ·ç«¯æš´éœ²åˆ›å»ºé€»è¾‘ï¼Œé€šè¿‡ä¸€ä¸ªå…±åŒçš„æ¥å£æ¥æŒ‡å‘æ–°åˆ›å»ºçš„å¯¹è±¡ã€‚

1.åˆ›å»ºä¸€ä¸ªæ¥å£

Shape.java

```java
public interface Shape {
  void draw();
}
```

2.åˆ›å»ºæ¥å£çš„å®ä½“ç±»

Rectangle.java

```java
public class Rectangle implements Shape {

  @Override
  public void draw() {
    System.out.println("Inside Rectangle::draw() method.");
  }
}
```

Square.java

```java
public class Square implements Shape {

  @Override
  public void draw() {
    System.out.println("Inside Square::draw() method.");
  }
}
```

Circle.java

```java
public class Circle implements Shape {

  @Override
  public void draw() {
    System.out.println("Inside Circle::draw() method.");
  }
}
```

3.åˆ›å»ºä¸€ä¸ªå·¥å‚ï¼Œç”ŸæˆåŸºäºç»™å®šä¿¡æ¯çš„å®ä½“ç±»çš„å¯¹è±¡

ShapeFactory.java

```java
public class ShapeFactory {

  //ä½¿ç”¨ getShape æ–¹æ³•è·å–å½¢çŠ¶ç±»å‹çš„å¯¹è±¡
  public Shape getShape(String shapeType){
    if(shapeType == null){
      return null;
    }
    if(shapeType.equalsIgnoreCase("CIRCLE")){
      return new Circle();
    } else if(shapeType.equalsIgnoreCase("RECTANGLE")){
      return new Rectangle();
    } else if(shapeType.equalsIgnoreCase("SQUARE")){
      return new Square();
    }
    return null;
  }
}
```

4.ä½¿ç”¨è¯¥å·¥å‚ï¼Œé€šè¿‡ä¼ é€’ç±»å‹ä¿¡æ¯æ¥è·å–å®ä½“ç±»çš„å¯¹è±¡

```java
public class FactoryPatternDemo {

  public static void main(String[] args) {
    ShapeFactory shapeFactory = new ShapeFactory();

    //è·å– Circle çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å®ƒçš„ draw æ–¹æ³•
    Shape shape1 = shapeFactory.getShape("CIRCLE");

    //è°ƒç”¨ Circle çš„ draw æ–¹æ³•
    shape1.draw();

    //è·å– Rectangle çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å®ƒçš„ draw æ–¹æ³•
    Shape shape2 = shapeFactory.getShape("RECTANGLE");

    //è°ƒç”¨ Rectangle çš„ draw æ–¹æ³•
    shape2.draw();

    //è·å– Square çš„å¯¹è±¡ï¼Œå¹¶è°ƒç”¨å®ƒçš„ draw æ–¹æ³•
    Shape shape3 = shapeFactory.getShape("SQUARE");

    //è°ƒç”¨ Square çš„ draw æ–¹æ³•
    shape3.draw();
  }
}
```

## ç¬¬ä¸‰éƒ¨åˆ† è®¾è®¡åŸåˆ™å’Œç¼–ç¨‹æŠ€å·§

### å•ä¸€èŒè´£åŸåˆ™(SRP)

ä¸€ä¸ªå¯¹è±¡(æ–¹æ³•)åªåšä¸€ä»¶äº‹æƒ…

SRP åŸåˆ™çš„ä¼˜ç‚¹æ˜¯é™ä½äº†å•ä¸ªç±»æˆ–è€…å¯¹è±¡çš„å¤æ‚åº¦ï¼ŒæŒ‰ç…§èŒè´£æŠŠå¯¹è±¡åˆ†è§£æˆæ›´å°çš„ç²’åº¦ï¼Œè¿™æœ‰åŠ©äºä»£ç çš„å¤ç”¨ï¼Œä¹Ÿæœ‰åˆ©äºè¿›è¡Œå•å…ƒæµ‹è¯•ã€‚å½“ä¸€ä¸ªèŒè´£éœ€è¦å˜æ›´çš„æ—¶å€™ï¼Œä¸ä¼šå½±å“åˆ°å…¶ä»–çš„èŒè´£ã€‚ä¼šå¢åŠ ç¼–å†™ä»£ç çš„å¤æ‚åº¦ï¼Œå½“æˆ‘ä»¬æŒ‰ç…§èŒè´£æŠŠå¯¹è±¡åˆ†è§£æˆæ›´å°çš„ç²’åº¦ä¹‹åï¼Œå®é™…ä¸Šå¢å¤§äº†è¿™äº›å¯¹è±¡ä¹‹é—´ç›¸äº’è”ç³»çš„éš¾åº¦ã€‚
